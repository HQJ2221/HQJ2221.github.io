<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/icons8-fox-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/icons8-fox-16.png">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif:300,300italic,400,400italic,700,700italic%7CJetBrains+Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/black/pace-theme-center-atom.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"hqj2221.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":280,"display":"post","padding":18,"offset":20},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Learning what OS do and how it functions.">
<meta property="og:type" content="article">
<meta property="og:title" content="操作系统">
<meta property="og:url" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/index.html">
<meta property="og:site_name" content="牛马农田">
<meta property="og:description" content="Learning what OS do and how it functions.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os201.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os202.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os203.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os204.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os205.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os206.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os301.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os302.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os303.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os304.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os305.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os306.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os307.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os308.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os309.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os310.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os311.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os312.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os313.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os314.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os315.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os316.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os317.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os318.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os319.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os320.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os321.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os322.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os323.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os324.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os501.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os502.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os503.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os504.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os505.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os506.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os507.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os508.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os509.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os510.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os511.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os512.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os513.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os514.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os515.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os516.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os517.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os518.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os519.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os520.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os521.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os522.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os523.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os524.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os525.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os601.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os602.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os603.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os604.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os605.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os606.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os607.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os701.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os702.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os703.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os704.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os705.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os706.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os707.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os708.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os709.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os710.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os711.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os801.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os802.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os803.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os804.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os805.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os901.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os902.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os908.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os903.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os904.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os905.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os906.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os907.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1001.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1002.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1003.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1004.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1005.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1006.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1007.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1008.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1009.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1101.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1102.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1103.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1104.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1105.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1201.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1202.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1203.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1204.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1205.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1206.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1207.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1208.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1209.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1210.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1211.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1212.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1213.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1214.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1215.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1217.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1216.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1218.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1219.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1220.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1221.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1301.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1302.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1303.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1304.png">
<meta property="og:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os1305.png">
<meta property="article:published_time" content="2024-09-13T15:27:27.000Z">
<meta property="article:modified_time" content="2024-12-17T16:57:45.009Z">
<meta property="article:author" content="Bionic l&#39;Hôpital">
<meta property="article:tag" content="CSE Learning">
<meta property="article:tag" content="Rust">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hqj2221.github.io/2024/09/13/Operating-Systems/os201.png">


<link rel="canonical" href="http://hqj2221.github.io/2024/09/13/Operating-Systems/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://hqj2221.github.io/2024/09/13/Operating-Systems/","path":"2024/09/13/Operating-Systems/","title":"操作系统"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>操作系统 | 牛马农田</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">牛马农田</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">没在 21 世纪的互联网留下赛博案底的人,</br> 只会度过一个相对失败的人生。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">11</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">8</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fas fa-list fa-fw"></i>Categories<span class="badge">6</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec01-Intro"><span class="nav-text">Lec01. Intro</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Before-this-course-about"><span class="nav-text">Before this course (about)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Definitions-of-OS"><span class="nav-text">Definitions of OS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#What-does-an-Operating-Systems-do"><span class="nav-text">What does an Operating Systems do ?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OS-Concepts"><span class="nav-text">OS Concepts</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Process-%E8%BF%9B%E7%A8%8B"><span class="nav-text">Process (进程)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Process-Management"><span class="nav-text">Process Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory"><span class="nav-text">Memory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory-Management"><span class="nav-text">Memory Management</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#File-System-amp-I-O"><span class="nav-text">File System &amp; I&#x2F;O</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Protection-and-Security"><span class="nav-text">Protection and Security</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec02-OS-Basics"><span class="nav-text">Lec02. OS Basics</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dual-Mode-Operations"><span class="nav-text">Dual-Mode Operations</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mode-Transitions"><span class="nav-text">Mode Transitions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#System-Calls"><span class="nav-text">System Calls</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Exception-and-Interrupt"><span class="nav-text">Exception and Interrupt</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kernel-Structure"><span class="nav-text">Kernel Structure</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Intro"><span class="nav-text">Intro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OS-Design-Principles"><span class="nav-text">OS Design Principles</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Operating-System-Services"><span class="nav-text">Operating System Services</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec03-Process"><span class="nav-text">Lec03. Process</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-1"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Process-and-System-Calls"><span class="nav-text">Process and System Calls</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What%E2%80%99s-a-process"><span class="nav-text">What’s a process ?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Process-Life-Cycle"><span class="nav-text">Process Life Cycle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What%E2%80%99s-System-calls"><span class="nav-text">What’s System calls ?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#System-Call-v-s-Library-API-Call"><span class="nav-text">System Call v.s. Library API Call</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Process-Creation"><span class="nav-text">Process Creation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#fork"><span class="nav-text">fork()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exec"><span class="nav-text">exec()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wait"><span class="nav-text">wait()</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kernel-view-of-processes"><span class="nav-text">Kernel view of processes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PCB"><span class="nav-text">PCB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Process-and-Thread"><span class="nav-text">Process and Thread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Context-Switch"><span class="nav-text">Context Switch</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kernel-view-of-fork-exec-and-wait-%E2%9D%97Important"><span class="nav-text">Kernel view of fork(), exec(), and wait() (❗Important)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overview-1"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fork-Kernel-View"><span class="nav-text">fork(): Kernel View</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#exec-Kernel-View"><span class="nav-text">exec(): Kernel View</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wait-and-exit-Kernel-View"><span class="nav-text">wait() and exit(): Kernel View</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#More-about-processes"><span class="nav-text">More about processes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-First-Process"><span class="nav-text">The First Process</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Measure-Process-Time"><span class="nav-text">Measure Process Time</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec04-CPU-Scheduler"><span class="nav-text">Lec04. CPU Scheduler</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-2"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scheduler-Concept"><span class="nav-text">Scheduler Concept</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Different-Algorithm"><span class="nav-text">Different Algorithm</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Shortest-Job-First-SJF"><span class="nav-text">Shortest Job First (SJF)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Round-robin-RR"><span class="nav-text">Round-robin (RR)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Priority-scheduling"><span class="nav-text">Priority scheduling</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Optimization-Completely-Fair-Scheduler"><span class="nav-text">Optimization: Completely Fair Scheduler</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec05-Synchronization"><span class="nav-text">Lec05. Synchronization</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-3"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Process-Communications"><span class="nav-text">Process Communications</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Problems-Synchronization-of-Threads-Processes"><span class="nav-text">Problems: Synchronization of Threads&#x2F;Processes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Race-Condition"><span class="nav-text">Race Condition</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Solution-Critical-Section"><span class="nav-text">Solution: Critical Section</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-Disabling-Interrupts"><span class="nav-text">Solution: Disabling Interrupts</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Solution-Spin-based-Locks"><span class="nav-text">Solution: Spin-based Locks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overview-about-Locks"><span class="nav-text">Overview about Locks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spin-based-lock"><span class="nav-text">Spin-based lock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Improvement-Peterson%E2%80%99s-Solution"><span class="nav-text">Improvement: Peterson’s Solution</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Multi-Process-Mutual-Exclusion"><span class="nav-text">Multi-Process Mutual Exclusion</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Priority-Inversion"><span class="nav-text">Priority Inversion</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Solution-Sleep-based-Locks"><span class="nav-text">Solution: Sleep-based Locks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Problems-solved-by-semaphore"><span class="nav-text">Problems solved by semaphore</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Producer-Consumer-Problem"><span class="nav-text">Producer-Consumer Problem</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dining-Philosopher-Problem"><span class="nav-text">Dining Philosopher Problem</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec06-Address-Translation"><span class="nav-text">Lec06. Address Translation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-4"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-Virtualization"><span class="nav-text">Memory Virtualization</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Address-Space"><span class="nav-text">Address Space</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Address-Translation"><span class="nav-text">Address Translation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Base-amp-Bound"><span class="nav-text">Base &amp; Bound</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Limitation"><span class="nav-text">Limitation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Segmentation-Generalized-Base-Bounds"><span class="nav-text">Segmentation: Generalized Base&#x2F;Bounds</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation"><span class="nav-text">Implementation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-Allocation"><span class="nav-text">Memory Allocation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Some-Strategies"><span class="nav-text">Some Strategies</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec07-Paging"><span class="nav-text">Lec07. Paging</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-5"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Intro-to-Paging"><span class="nav-text">Intro to Paging</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Multi-level-page-tables"><span class="nav-text">Multi-level page tables</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Other-Page-Table-Strctures"><span class="nav-text">Other Page Table Strctures</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Real-world-Paging-Scheme"><span class="nav-text">Real-world Paging Scheme</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Translation-Lookaside-Buffer"><span class="nav-text">Translation Lookaside Buffer</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec08-Demand-Paging"><span class="nav-text">Lec08. Demand Paging</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-6"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Demand-Paging-Mechanisms"><span class="nav-text">Demand Paging Mechanisms</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Swap-Space"><span class="nav-text">Swap Space</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Demand-Paging"><span class="nav-text">Demand Paging</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Page-Fault"><span class="nav-text">Page Fault</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Page-Replacement-Policy"><span class="nav-text">Page Replacement Policy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Effective-Access-Time-EAT"><span class="nav-text">Effective Access Time (EAT)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Page-Replacement-Policies"><span class="nav-text">Page Replacement Policies</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LRU-Impl"><span class="nav-text">LRU Impl</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Clock-Algorithm"><span class="nav-text">Clock Algorithm</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Page-Frame-Allocation"><span class="nav-text">Page Frame Allocation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Allocation-Algorithms"><span class="nav-text">Allocation Algorithms</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec09-Linux-Memory-Management"><span class="nav-text">Lec09. Linux Memory Management</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-7"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Address-Space-in-Linux"><span class="nav-text">Address Space in Linux</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Slab-Allocator"><span class="nav-text">Slab Allocator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Buddy-System"><span class="nav-text">Buddy System</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec10-I-O"><span class="nav-text">Lec10. I&#x2F;O</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-8"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#I-O-Management-amp-View-of-Device"><span class="nav-text">I&#x2F;O Management &amp; View of Device</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Basic-I-O-Polling"><span class="nav-text">Basic I&#x2F;O: Polling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Efficient-I-O-Interrupts"><span class="nav-text">Efficient I&#x2F;O: Interrupts</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-Movement"><span class="nav-text">Data Movement</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Programmed-I-O"><span class="nav-text">Programmed I&#x2F;O</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DMA"><span class="nav-text">DMA</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Device-Driver"><span class="nav-text">Device Driver</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Life-Cycle-of-an-I-O-Request"><span class="nav-text">Life Cycle of an I&#x2F;O Request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Different-types-of-device"><span class="nav-text">Different types of device</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec11-Storage"><span class="nav-text">Lec11. Storage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-9"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Storage-Devices"><span class="nav-text">Storage Devices</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Concepts-for-Magnetic-Disk"><span class="nav-text">Concepts for Magnetic Disk</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Calculation-Time-of-read-write"><span class="nav-text">Calculation: Time of read&#x2F;write</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Disk-Scheduling"><span class="nav-text">Disk Scheduling</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec12-File-System"><span class="nav-text">Lec12. File System</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-10"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-System-Basic"><span class="nav-text">File System Basic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Contiguous-Allocation"><span class="nav-text">Contiguous Allocation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linked-Allocation"><span class="nav-text">Linked Allocation</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Comparison-to-contiguous-allocation"><span class="nav-text">Comparison to contiguous allocation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FAT"><span class="nav-text">FAT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Header-of-file-name"><span class="nav-text">Header of file name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#About-FAT-reading-appending-and-deleting-files"><span class="nav-text">About FAT reading, appending and deleting files</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#iNode"><span class="nav-text">iNode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Ext-2-3-4"><span class="nav-text">Ext 2 &#x2F; 3 &#x2F; 4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ext-2-3"><span class="nav-text">Ext 2&#x2F;3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hard-amp-Soft-link"><span class="nav-text">Hard &amp; Soft link</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec13-Deadlock"><span class="nav-text">Lec13. Deadlock</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-11"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deadlock-Basic"><span class="nav-text">Deadlock Basic</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Two-ways-to-handle-deadlock"><span class="nav-text">Two ways to handle deadlock</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Deadlock-detection-with-Resource-Allocation-Graphs"><span class="nav-text">Deadlock detection with Resource Allocation Graphs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Deadlock-Prevention"><span class="nav-text">Deadlock Prevention</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Banker%CA%BCs-Algorithm"><span class="nav-text">Bankerʼs Algorithm</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec14-Security-and-Protection"><span class="nav-text">Lec14. Security and Protection</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-12"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Access-Matrix"><span class="nav-text">Access Matrix</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Principles-of-Protection"><span class="nav-text">Principles of Protection</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Access-Matrix-1"><span class="nav-text">Access Matrix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-of-Access-Matrix"><span class="nav-text">Implementation of Access Matrix</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Security"><span class="nav-text">Security</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementation-of-Security-Defenses"><span class="nav-text">Implementation of Security Defenses</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Firewalling-to-Protect-Systems-and-Networks"><span class="nav-text">Firewalling to Protect Systems and Networks</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cryptography"><span class="nav-text">Cryptography</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Encryption"><span class="nav-text">Encryption</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Authentication"><span class="nav-text">Authentication</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Certification-in-Network"><span class="nav-text">Certification in Network</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lec15-Virtualization"><span class="nav-text">Lec15. Virtualization</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Outline-13"><span class="nav-text">Outline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#About-Virtualization"><span class="nav-text">About Virtualization</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bionic l'Hôpital"
      src="/images/me.png">
  <p class="site-author-name" itemprop="name">Bionic l'Hôpital</p>
  <div class="site-description" itemprop="description">仿生洛必达的个人站点</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/HQJ2221" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;HQJ2221" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/" title="Bilibili → &#x2F;" rel="noopener me"><i class="fab fa-bilibili fa-fw"></i>Bilibili</a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://hqj2221.github.io/2024/09/13/Operating-Systems/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/me.png">
      <meta itemprop="name" content="Bionic l'Hôpital">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="牛马农田">
      <meta itemprop="description" content="仿生洛必达的个人站点">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="操作系统 | 牛马农田">
      <meta itemprop="description" content="Learning what OS do and how it functions.">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          操作系统
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-09-13 23:27:27" itemprop="dateCreated datePublished" datetime="2024-09-13T23:27:27+08:00">2024-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-12-18 00:57:45" itemprop="dateModified" datetime="2024-12-18T00:57:45+08:00">2024-12-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/2024-Fall/" itemprop="url" rel="index"><span itemprop="name">2024 Fall</span></a>
        </span>
    </span>

  
</div>

            <div class="post-description">Learning what OS do and how it functions.</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="Lec01-Intro"><a href="#Lec01-Intro" class="headerlink" title="Lec01. Intro"></a>Lec01. Intro</h1><h2 id="Before-this-course-about"><a href="#Before-this-course-about" class="headerlink" title="Before this course (about)"></a>Before this course (about)</h2><ul>
<li>Have basic concept about Computer Organization</li>
<li>Be familiar to at least one programming language (better be <code>C / C++</code>)</li>
<li>We use <code>Rust</code> as example code in this course<ul>
<li>Learning Rust : <a target="_blank" rel="noopener" href="https://doc.rust-lang.org/stable/book/">https://doc.rust-lang.org/stable/book</a></li>
<li>Search for OSTD <code>lib</code> and <code>mod</code> : <a target="_blank" rel="noopener" href="https://docs.rs/ostd/latest/ostd/">https://docs.rs/ostd/latest/ostd/</a></li>
</ul>
</li>
</ul>
<h2 id="Definitions-of-OS"><a href="#Definitions-of-OS" class="headerlink" title="Definitions of OS"></a>Definitions of OS</h2><blockquote>
<p>What is a computer ?</p>
<p>How does a modern computer work ?</p>
<p>What is operating systems ?</p>
</blockquote>
<ul>
<li>Structure of a Computer System (4 parts)<ul>
<li>Hardware<ul>
<li>Provides basic computing resources</li>
<li>CPU, memory, I/O devices</li>
</ul>
</li>
<li>Operating system<ul>
<li>Controls and coordinates use of hardware among various applications and users</li>
</ul>
</li>
<li>Application programs<ul>
<li>Define the ways in which the system resources are used to solve the computing problems of the users</li>
<li>Word processors, compilers, web browsers, database systems, video games</li>
</ul>
</li>
<li>Users<ul>
<li>People, machines, other computers</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Def.</strong> OS is a group of software that makes the computer operate <font color="red">correctly and efficiently</font> in an easy-to-use manner.</p>
<ul>
<li>Execute user programs and make solving user problems easier</li>
<li>Make the computer system convenient to use</li>
<li>Use the computer hardware in an efficient manner (hardware abstraction)</li>
</ul>
<blockquote>
<p>ask again: what is an OS ?</p>
</blockquote>
<ul>
<li>It includes a software program called <fong color="red">kernel&lt;/font&gt;<ul>
<li>manages all the physical devices (e.g., CPU, RAM and hard disk)</li>
<li>exposes some functions such as <font color="red">system calls</font> for others to configure the kernel or build software (e.g., C library)  on top</li>
</ul>
</fong></li>
<li>It includes other ”helper” programs<ul>
<li>Such as a <fong color="red">shell&lt;/font&gt;, which renders a simple command-line user interface with a full set of commands</fong></li>
<li>Such as a <fong color="red">GUI&lt;/font&gt; (graphic user interface), which renders a user friendly interface with icons representing files and folders</fong></li>
<li>Such as a <fong color="red">Browser&lt;/font&gt;, which helps the user to visit websites</fong></li>
</ul>
</li>
</ul>
<blockquote>
<p>ask again and again: what is an OS ?</p>
</blockquote>
<ul>
<li>An OS is a <fong color="red">resource manager&lt;/font&gt;<ul>
<li>Managing CPUs, memory, disks, I/O devices (keyboards, USB drive, sensors, …)</li>
<li>Arbitrator of conflicting requests for efficient and fair resource use</li>
</ul>
</fong></li>
<li>An OS is a <fong color="red">control program&lt;/font&gt;<ul>
<li>Controls execution of programs to prevent errors and improper use of the computer</li>
</ul>
</fong></li>
</ul>
<blockquote>
<font face="Segoe Script" size="5">SHORT SUMMARY</font>

<p>There is no exact definition about Operating System. It can have so many functions and computer depends on it so much.<br>It’s like a bridge between users and hardware, between applications and hardware. All of the modern computer cannot live without Operating Systems.</p>
<p>But what an OS actually do ?</p>
</blockquote>
<h2 id="What-does-an-Operating-Systems-do"><a href="#What-does-an-Operating-Systems-do" class="headerlink" title="What does an Operating Systems do ?"></a>What does an Operating Systems do ?</h2><ul>
<li>Virtualization (虚拟化)<ul>
<li>Virtualize CPU: Run multiple programs on a single CPU (as if there are many CPUs)</li>
<li>Virtualize memory: Give each process (or programs if you will) the illusion of running in its own memory address space</li>
</ul>
</li>
<li>Concurrency (并发性)<ul>
<li>Run multi-threaded programs and make sure they execute correctly</li>
</ul>
</li>
<li>Persistence (持久性)<ul>
<li>Write data (from volatile SRAM/DRAM) into persistent storage</li>
<li>Performance, crash-resilience</li>
</ul>
</li>
<li>etc.</li>
</ul>
<p><em>Organzied by the functionalities of OS (<strong>three easy pieces</strong>)</em></p>
<ul>
<li>Virtualization (Process, scheduling, memory address space, swapping)</li>
<li>Concurrency (Threads, locks, semaphores)</li>
<li>Persistence (I/O, storage, file systems)</li>
</ul>
<h2 id="OS-Concepts"><a href="#OS-Concepts" class="headerlink" title="OS Concepts"></a>OS Concepts</h2><h3 id="Process-进程"><a href="#Process-进程" class="headerlink" title="Process (进程)"></a>Process (进程)</h3><p><strong>Def.</strong> A process is a program in execution. (Program is a passive entity and process is an active entity.)</p>
<p><strong>Properties</strong></p>
<ul>
<li>Process needs resources to accomplish its task<ul>
<li>CPU, memory, I/O, files</li>
<li>Process termination requires reclaim of any reusable resources</li>
</ul>
</li>
<li>Process executes instructions sequentially, one at a time, until completion<ul>
<li>Single-threaded process has one program counter specifying location of next instruction to execute</li>
<li>Multi-threaded process has one program counter per thread</li>
</ul>
</li>
<li>Typically, system has many processes, some user, some operating system running concurrently on one or more CPUs<ul>
<li>Concurrency by multiplexing the CPUs among the processes / threads</li>
</ul>
</li>
</ul>
<h3 id="Process-Management"><a href="#Process-Management" class="headerlink" title="Process Management"></a>Process Management</h3><ul>
<li>Creating and deleting both user and system processes</li>
<li>Suspending and resuming processes</li>
<li>Providing mechanisms for process synchronization</li>
<li>Providing mechanisms for process communication</li>
<li>Providing mechanisms for deadlock handling</li>
</ul>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><ul>
<li>DRAM (Dynamic Random Access Memory) is the main memory used for all desktop, laptops, servers, and mobile devices</li>
<li>CPU only directly interacts with the main memory during execution<ul>
<li>All data in memory before and after processing</li>
<li>All instructions in memory in order to execute</li>
</ul>
</li>
<li>OS manages the main memory for kernel and processes<ul>
<li>OS dictates which process can access which memory regio</li>
</ul>
</li>
</ul>
<h3 id="Memory-Management"><a href="#Memory-Management" class="headerlink" title="Memory Management"></a>Memory Management</h3><ul>
<li>Memory management determines what is in memory when<ul>
<li>Optimizing CPU utilization and computer response to users</li>
</ul>
</li>
<li>Memory management activities<ul>
<li>Keeping track of which parts of memory are currently being used and by whom</li>
<li>Deciding which processes (or parts thereof) and data to move into and out of memory</li>
<li>Allocating and deallocating memory space as needed</li>
</ul>
</li>
</ul>
<h3 id="File-System-amp-I-O"><a href="#File-System-amp-I-O" class="headerlink" title="File System &amp; I/O"></a>File System &amp; I/O</h3><ul>
<li>File-System management<ul>
<li>Files usually organized into directories</li>
<li>Access control on most systems to determine who can access what</li>
<li>OS activities include<ul>
<li>Creating and deleting files and directories</li>
<li>Primitives to manipulate files and dirs</li>
<li>Mapping files onto secondary storage</li>
<li>Backup files onto stable (non-volatile) storage media</li>
</ul>
</li>
</ul>
</li>
<li>I/O Subsystem<ul>
<li>One purpose of OS is to hide peculiarities of hardware devices from the user</li>
<li>I/O subsystem responsible for<ul>
<li>Memory management of I/O including <ul>
<li>buffering (storing data temporarily while it is being transferred)</li>
<li>caching (storing parts of data in faster storage for performance)</li>
</ul>
</li>
<li>General device-driver interface</li>
<li>Drivers for specific hardware devices</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Protection-and-Security"><a href="#Protection-and-Security" class="headerlink" title="Protection and Security"></a>Protection and Security</h3><ul>
<li>Protection 👉 any mechanism for controlling access of processes or users to resources defined by the OS</li>
<li>Security 👉 defense of the system against internal and external attacks<ul>
<li>Huge range, including denial-of-service (DoS), worms (蠕虫), viruses, identity theft, theft of service</li>
</ul>
</li>
</ul>
<hr>
<h1 id="Lec02-OS-Basics"><a href="#Lec02-OS-Basics" class="headerlink" title="Lec02. OS Basics"></a>Lec02. OS Basics</h1><h2 id="Outline"><a href="#Outline" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Dual-mode operations</li>
<li>Kernel structure</li>
<li>Operating system services</li>
</ul>
<h2 id="Dual-Mode-Operations"><a href="#Dual-Mode-Operations" class="headerlink" title="Dual-Mode Operations"></a>Dual-Mode Operations</h2><h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><ul>
<li>Evolution of OS<ul>
<li>A library to handle low-level I/O<ul>
<li>Issue: Fault and security isolation</li>
</ul>
</li>
<li>Kernel: A bigger “library” to handle low-level I/O<ul>
<li>Kernel needs to be protected from faulty/malicious apps</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os201.png"></p>
<ul>
<li>Application code runs in <font color="red">User mode</font></li>
<li>Kernel code runs in <font color="red">Kernel mode</font><ul>
<li>Dual-mode operation allows OS to protect itself and other system components (attack from app can be handle by kernel)</li>
</ul>
</li>
<li><font color="red">Question:</font> What is needed in the hardware to support “dual mode” operation?<ul>
<li>A bit for representing current mode (user/kernel mode bit)</li>
<li>Certain operations / actions only permitted in kernel mode (in user mode they fail or trap)</li>
<li>{ User 👉 Kernel } transition sets kernel mode AND saves the user PC<ul>
<li>Operating system code carefully puts aside user state then performs the necessary operations</li>
</ul>
</li>
<li>{ Kernel 👉 User } transition clears kernel mode AND restores appropriate user PC</li>
</ul>
</li>
</ul>
<p>Mode bits on different architectures 👇</p>
<table><tr>
    <td><img src="/2024/09/13/Operating-Systems/os202.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os203.png"></td>
</tr></table>



<h3 id="Mode-Transitions"><a href="#Mode-Transitions" class="headerlink" title="Mode Transitions"></a>Mode Transitions</h3><p>Three types :</p>
<ul>
<li>System call <ul>
<li>Process requests a system service, e.g., <code>exit</code></li>
<li>Like a function call, but <fotn color="blue">“outside” the process&lt;/font&gt;</fotn></li>
<li>Does not have the address of the system function to call</li>
<li>Marshall (排序？) the syscall id and args in registers and exec syscall</li>
</ul>
</li>
<li>Interrupt<ul>
<li>External asynchronous event <font color="red">triggers context switch</font></li>
<li>e. g., Timer, I/O device</li>
<li>Independent of user process</li>
</ul>
</li>
<li>Trap or Exception<ul>
<li>Internal synchronous event in process triggers context switch</li>
<li>e.g., Protection violation (segmentation fault), Divide by zero, …</li>
</ul>
</li>
</ul>
<h4 id="System-Calls"><a href="#System-Calls" class="headerlink" title="System Calls"></a>System Calls</h4><p><strong>Def.</strong> Programming interface to the services provided by the OS, typically written in a high-level language (C or C++).</p>
<blockquote>
<p>中文解释：系统调用是一个用高级程序语言定义的，调用操作系统提供的服务的程序接口。</p>
</blockquote>
<p><strong>Implementation</strong></p>
<ul>
<li>Typically, a number associated with each system call<ul>
<li>System-call interface maintains a table indexed according to these numbers</li>
</ul>
</li>
<li>The system call interface invokes intended system call in OS kernel and returns status of the system call and any return values <font color="blue">(a basic example below)</font></li>
<li>The caller needs to know nothing about how the system call is implemented<ul>
<li>Just needs to obey calling convention and understand what OS will do </li>
<li>Most details of OS interface hidden from programmer by library API<ul>
<li>Managed by run-time support library (set of functions built into libraries included with compiler)</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[allow(dead_code)]</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">fn</span> <span class="title function_">handle_syscall</span>(user_context: &amp;<span class="keyword">mut</span> UserContext, user_space: &amp;UserSpace) &#123;</span><br><span class="line">  <span class="keyword">const</span> SYS_EXIT: <span class="type">usize</span> = <span class="number">93</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> <span class="variable">args</span> = [</span><br><span class="line">    user_context.<span class="title function_ invoke__">a0</span>(),</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ];</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">let</span> <span class="variable">ret</span>: <span class="type">Result</span>&lt;SyscallReturn&gt; = <span class="keyword">match</span> user_context.<span class="title function_ invoke__">a7</span>() &#123;</span><br><span class="line">    SYS_EXIT =&gt; &#123;</span><br><span class="line">      <span class="comment">// operations</span></span><br><span class="line">      <span class="title function_ invoke__">Ok</span>(SyscallReturn::NoReturn)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Other syscalls</span></span><br><span class="line">  &#125;</span><br><span class="line">	</span><br><span class="line">  <span class="keyword">match</span> ret &#123;</span><br><span class="line">    <span class="title function_ invoke__">Ok</span>(val) =&gt; <span class="keyword">match</span> val &#123;</span><br><span class="line">      SyscallReturn::<span class="title function_ invoke__">Return</span>(val) =&gt; user_context.<span class="title function_ invoke__">set_a0</span>(val <span class="keyword">as</span> <span class="type">usize</span>),</span><br><span class="line">      SyscallReturn::NoReturn =&gt; &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_ invoke__">Err</span>(err) =&gt; user_context.<span class="title function_ invoke__">set_a0</span>(-(err.<span class="title function_ invoke__">error</span>() <span class="keyword">as</span> <span class="type">i32</span> <span class="keyword">as</span> <span class="type">isize</span>) <span class="keyword">as</span> <span class="type">usize</span>),</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>Types of Syscalls</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os204.png"></p>
<h4 id="Exception-and-Interrupt"><a href="#Exception-and-Interrupt" class="headerlink" title="Exception and Interrupt"></a>Exception and Interrupt</h4><ul>
<li><strong>Exceptions (synchronous)</strong> react to an abnormal condition <ul>
<li>E.g., Map the swapped-out page back to memory</li>
<li>Divide by zero</li>
<li>Illegal memory accesses</li>
</ul>
</li>
<li><strong>Interrupts (asynchronous)</strong> preempt normal execution <ul>
<li>Notification from device (e.g., new packets, disk I/O completed)</li>
<li>Preemptive scheduling (e.g., timer ticks)</li>
<li>Notification from another CPU (i.e., Inter-processor Interrupts)</li>
</ul>
</li>
<li>More about (in the same procedure)<ul>
<li>Stop execution of the current program</li>
<li>Start execution of a handler</li>
<li>Processor accesses the handler through an entry in the <fotn color="red">Interrupt Descriptor Table (IDT)&lt;/font&gt;</fotn></li>
<li>Each interrupt is defined by a number</li>
</ul>
</li>
</ul>
<h2 id="Kernel-Structure"><a href="#Kernel-Structure" class="headerlink" title="Kernel Structure"></a>Kernel Structure</h2><h3 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h3><p><strong>I. Monolithic Kernel</strong></p>
<ul>
<li>A monolithic kernel is an operating system software framework that holds <font color="red">all privileges to access</font> I/O devices, memory, hardware interrupts and the CPU stack. </li>
<li>Monolithic kernels <font color="red">contain many components</font>, such as memory subsystems and I/O subsystems, and are usually very large.<ul>
<li>Including filesystems, device drivers, etc.</li>
</ul>
</li>
<li>Monolithic kernel is the basis for Linux, Unix, MS-DOS.</li>
</ul>
<p><strong>II. Micro Kernel</strong></p>
<ul>
<li>Microkernels outsource the traditional operating system functionality to ordinary user processes for better flexibility, security, and fault tolerance.</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os205.png"></p>
<ul>
<li>OS functionalities are pushed to user-level servers (e.g., user-level memory manager) </li>
<li>User-level servers are trusted by the kernel (often run as root)</li>
<li>Protection mechanisms stay in kernel while resource management policies go to the user-level servers</li>
<li>Representative micro-kernel OS<ul>
<li>Mach, 1980s at CMU</li>
<li>seL4, the first formally verified micro-kernel, more on <a target="_blank" rel="noopener" href="http://sel4.systems/">http://sel4.systems</a></li>
</ul>
</li>
</ul>
<p><strong>Pros and Cons</strong></p>
<ul>
<li>Pros<ul>
<li>Kernel is more responsive (kernel functions in preemptible user-level processes)</li>
<li>Better stability and security (less code in kernel)</li>
<li>Better support of concurrency and distributed OS (later…..)</li>
</ul>
</li>
<li>Cons<ul>
<li>More IPC needed and thus more context switches (slower)</li>
</ul>
</li>
</ul>
<p><strong>III. Hybrid Kernel</strong></p>
<ul>
<li>A combination of a monolithic kernel and a micro kernel<ul>
<li>Example: Windows OS</li>
</ul>
</li>
</ul>
<p><strong>IV. FrameKernel: Asterinas</strong></p>
<p><img src="/2024/09/13/Operating-Systems/os206.png"></p>
<h3 id="OS-Design-Principles"><a href="#OS-Design-Principles" class="headerlink" title="OS Design Principles"></a>OS Design Principles</h3><ul>
<li>Internal structure of different Operating Systems can vary widely<ul>
<li>Start by defining goals and specifications </li>
<li>Affected by choice of hardware, type of system</li>
</ul>
</li>
<li>User goals and System goals<ul>
<li>User goals 👉 operating system should be convenient to use, easy to learn, reliable, safe, and fast</li>
<li>System goals 👉 operating system should be easy to design, implement, and maintain, as well as flexible, reliable, error-free, and efficient</li>
</ul>
</li>
<li>OS separates policies and mechanisms<ul>
<li>Policy: which software could access which resource at what time<ul>
<li>E.g., if two processes access the same device at the same time, which one goes first</li>
<li>E.g., if a process hopes to read from keyboard</li>
</ul>
</li>
<li>Mechanism: How is the policy enforced<ul>
<li>E.g., request queues for devices, running queues for CPUs</li>
<li>E.g., access control list for files, devices, etc.</li>
</ul>
</li>
<li>The separation of policy from mechanism is a very important principle, it allows <font color="red">maximum flexibility</font> if policy decisions are to be changed later</li>
</ul>
</li>
</ul>
<h2 id="Operating-System-Services"><a href="#Operating-System-Services" class="headerlink" title="Operating System Services"></a>Operating System Services</h2><p><strong>I. User-helpful OS services</strong></p>
<ul>
<li><font color="red">User interface</font> - Almost all operating systems have a user interface (UI)<ul>
<li>Varies between Command-Line (CLI), Graphics User Interface (GUI), Batch</li>
</ul>
</li>
<li><font color="red">Program execution</font> - The system must be able to load a program into memory and to run that program, end execution, either normally or abnormally (indicating error)</li>
<li><font color="red">I/O operations</font> -  A running program may require I/O, which may involve a file or an I/O device </li>
<li><font color="red">File-system manipulation</font> -  The file system is of particular interest. Obviously, programs need to read and write files and directories, create and delete them, search them, list file Information, permission management</li>
<li>Communications – Processes may exchange information, on the same computer or between computers over a network<ul>
<li>Communications may be via shared memory or through message passing (packets moved by the OS)</li>
</ul>
</li>
<li>Error detection – OS needs to be constantly aware of possible errors<ul>
<li>May occur in the CPU and memory hardware, in I/O devices, in user program</li>
<li>For each type of error, OS should take the appropriate action to ensure correct and consistent computing</li>
<li>Debugging facilities can greatly enhance the user’s and programmer’s abilities to efficiently use the system</li>
</ul>
</li>
</ul>
<p><strong>II. User Operating System Interface</strong></p>
<ul>
<li><font color="red">Command Line Interface (CLI)</font> or command interpreter allows direct command entry</li>
<li><font color="red">User-friendly desktop metaphor interface</font><ul>
<li>e.g. mouse, keyboard and monitor. Icons of app.</li>
</ul>
</li>
<li>Many systems now include both CLI and GUI interfaces</li>
</ul>
<p><strong>III. System Programs</strong></p>
<ul>
<li>Provide a convenient environment for program development and execution</li>
<li>Most users’ view of the operation system is defined by system programs<ul>
<li>File management </li>
<li>Status Info</li>
</ul>
</li>
<li>Programming-language support 👉 Compilers, assemblers, debuggers and interpreters sometimes provided</li>
<li>Program loading and execution</li>
<li>Communications 👉 Provide the mechanism for creating virtual connections among processes, users, and computer systems</li>
</ul>
<hr>
<h1 id="Lec03-Process"><a href="#Lec03-Process" class="headerlink" title="Lec03. Process"></a>Lec03. Process</h1><h2 id="Outline-1"><a href="#Outline-1" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Process and system calls</li>
<li>Process creation</li>
<li>Kernel view of processes</li>
<li>Kernel view of <code>fork()</code>, <code>exec()</code>, and <code>wait()</code></li>
<li>More about processes</li>
</ul>
<h2 id="Process-and-System-Calls"><a href="#Process-and-System-Calls" class="headerlink" title="Process and System Calls"></a>Process and System Calls</h2><h3 id="What’s-a-process"><a href="#What’s-a-process" class="headerlink" title="What’s a process ?"></a>What’s a process ?</h3><ul>
<li>Process is a program in execution</li>
<li>A program is a file on the disk<ul>
<li>Code and static data</li>
</ul>
</li>
<li>A process is loaded by the OS <ul>
<li>Code and static data are loaded from the program</li>
<li>Heap and stack are created by the OS</li>
</ul>
</li>
<li>A process is an abstraction of machine states<ul>
<li>Memory: address space</li>
<li>Register:<ul>
<li>Program Counter (PC) or Instruction Pointer</li>
<li>Stack pointer</li>
<li>frame pointer</li>
</ul>
</li>
<li>I/O: all files opened by the process</li>
</ul>
</li>
</ul>
<blockquote>
<p>Seems that definitions of process are multiple, there is only one way to get unique process.</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;My PID is %d\n&quot;</span>, getpid());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Process-Life-Cycle"><a href="#Process-Life-Cycle" class="headerlink" title="Process Life Cycle"></a>Process Life Cycle</h3><p><img src="/2024/09/13/Operating-Systems/os301.png" style="zoom:70%"></p>
<h3 id="What’s-System-calls"><a href="#What’s-System-calls" class="headerlink" title="What’s System calls ?"></a>What’s System calls ?</h3><ul>
<li>System call is a function call.<ul>
<li>exposed by the kernel.</li>
<li>abstraction of kernel operations.</li>
</ul>
</li>
<li>System call is <font color="red">a call by number</font></li>
<li>System call sometimes need extra parameter. Three ways to pass param.<ul>
<li>Registers: pass the parameters in registers<ul>
<li>In some cases, may be more parameters than registers</li>
<li><code>x86</code> and <code>risc-v</code> take this approach</li>
</ul>
</li>
<li>Blocks: Parameters stored in a memory block and <font color="red">address of the block passed</font> as a parameter in a register (e.g. pic below)</li>
<li>Stack: Parameters placed, or pushed, onto the stack by the program and popped off the stack by the operating system<ul>
<li>Block and stack methods do not limit the number or length of parameters being passed</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os302.png"></p>
<h3 id="System-Call-v-s-Library-API-Call"><a href="#System-Call-v-s-Library-API-Call" class="headerlink" title="System Call v.s. Library API Call"></a>System Call v.s. Library API Call</h3><p>Test:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Name</th>
<th style="text-align:center">System call ?</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>printf()</code> &amp; <code>scanf()</code></td>
<td style="text-align:center">No</td>
</tr>
<tr>
<td style="text-align:center"><code>malloc()</code> &amp; <code>free()</code></td>
<td style="text-align:center">NO</td>
</tr>
<tr>
<td style="text-align:center"><code>fopen()</code> &amp; <code>fclose()</code></td>
<td style="text-align:center">No</td>
</tr>
<tr>
<td style="text-align:center"><code>mkdir()</code> &amp; <code>rmdir()</code></td>
<td style="text-align:center">Yes</td>
</tr>
<tr>
<td style="text-align:center"><code>chown()</code> &amp; <code>chmod()</code></td>
<td style="text-align:center">Yes</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>E.g. <code>fopen()</code><ul>
<li><code>fopen()</code> invokes the system call <code>open()</code>.</li>
<li><code>open()</code> is too primitive and is not programmer-friendly!</li>
</ul>
</li>
</ul>
<h2 id="Process-Creation"><a href="#Process-Creation" class="headerlink" title="Process Creation"></a>Process Creation</h2><h3 id="fork"><a href="#fork" class="headerlink" title="fork()"></a><code>fork()</code></h3><ul>
<li>Parent process create children processes. (form <strong>tree</strong> structure)</li>
<li>use <code>pid</code> to identify a process</li>
<li>Address space<ul>
<li>Child duplicate of parent</li>
<li>Child has a program loaded into it</li>
</ul>
</li>
<li>UNIX examples<ul>
<li><code>fork()</code> system call creates new process</li>
<li><code>exec()</code> system call used after a fork to replace the process’ memory space with a new program</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os303.png"></p>
<ul>
<li>View on example : 👆<ul>
<li>Both the parent and the child <font color="red">execute the same program</font>.</li>
<li>The child process starts its execution at the location that <code>fork()</code> is returned, <font color="red">not from the beginning of the program</font>.</li>
</ul>
</li>
<li>Another example below :</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="type">int</span> result;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;before fork...\n&quot;</span>);</span><br><span class="line">  result = fork();  <span class="comment">// System call</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;result = %d&quot;</span>, result);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (result == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m the child. My PID is %d\n&quot;</span>, getpid());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m the parent. My PID is %d\n&quot;</span>, getpid());</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Program terminated.\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Suppose parent’s pid is 1234. Then the <code>fork()</code> create a child process with pid 1235.</li>
<li><code>fork()</code> returns value for both parent and child process. See how they differ in value.</li>
<li><font color="red">CPU decides</font> which process run first.</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># if child run first:</span><br><span class="line">$ ./fork_example</span><br><span class="line">before fork...</span><br><span class="line">result = 0</span><br><span class="line">I&#x27;m the child. My PID is 1235</span><br><span class="line">Program terminated.</span><br><span class="line">result = 1235</span><br><span class="line">I&#x27;m the parent. My PID is 1234</span><br><span class="line">Program terminated.</span><br><span class="line"></span><br><span class="line"># if parent run first:</span><br><span class="line">$ ./fork_example</span><br><span class="line">before fork...</span><br><span class="line">result = 1235</span><br><span class="line">I&#x27;m the parent. My PID is 1234</span><br><span class="line">Program terminated.</span><br><span class="line">result = 0</span><br><span class="line">I&#x27;m the child. My PID is 1235</span><br><span class="line">Program terminated.</span><br></pre></td></tr></table></figure>
<ul>
<li><code>fork()</code> behaves like “cell division”.<ul>
<li>It creates the child process by cloning from the parent process, including all user-space data</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Cloned items</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Program counter<br>[CPU register]</td>
<td style="text-align:center">That’s why they both execute from the same line of code after <code>fork()</code> returns.</td>
</tr>
<tr>
<td style="text-align:center">Program code<br>[File &amp; Memory]</td>
<td style="text-align:center">They are sharing the same piece of code.</td>
</tr>
<tr>
<td style="text-align:center">Memory</td>
<td style="text-align:center">Including local variables, global variables, and dynamically allocated memory.</td>
</tr>
<tr>
<td style="text-align:center">Opened files<br>[Kernel’s internal]</td>
<td style="text-align:center">If the parent has opened a file “fd”, then the child will also have file “fd” opened automatically.</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><ul>
<li>also something distinct:</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Distinct items</th>
<th style="text-align:center">Parent</th>
<th style="text-align:center">Child</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Return value of <code>fork()</code></td>
<td style="text-align:center">PID of child</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">PID</td>
<td style="text-align:center">unchanged</td>
<td style="text-align:center">new pid(not necessarily parent’s +1)</td>
</tr>
<tr>
<td style="text-align:center">Parent process</td>
<td style="text-align:center">unchanged</td>
<td style="text-align:center">Parent.</td>
</tr>
<tr>
<td style="text-align:center">Running time</td>
<td style="text-align:center">Cumulated</td>
<td style="text-align:center">Just created, should be 0</td>
</tr>
<tr>
<td style="text-align:center">[Advanced]File locks</td>
<td style="text-align:center">unchanged</td>
<td style="text-align:center">None</td>
</tr>
</tbody>
</table>
</div>
<h3 id="exec"><a href="#exec" class="headerlink" title="exec()"></a><code>exec()</code></h3><blockquote>
<p>If a process can only <strong>duplicate itself</strong> and <strong>always runs the same program</strong>, it’s not meaningful. How can we execute other programs ?</p>
<p>Answer: using <code>exec()</code> system call !</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Before execl...\n&quot;</span>);</span><br><span class="line">  execl(<span class="string">&quot;/bin/ls&quot;</span>, <span class="string">&quot;/bin/ls&quot;</span>, <span class="literal">NULL</span>);  <span class="comment">// what does this mean?</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;after execl...\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Output</span></span><br><span class="line">$ ./exec_example</span><br><span class="line">Before execl...</span><br><span class="line">./exec_example</span><br><span class="line">./exec_example.c</span><br><span class="line">$ _</span><br></pre></td></tr></table></figure>
<ul>
<li>Detail about <code>exec()</code></li>
<li>Run the command <code>/bin/ls</code></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Argument Order</th>
<th style="text-align:center">Value in example</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">“/bin/ls”</td>
<td style="text-align:center">The file that the programmer wants to execute.</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">“/bin/ls”</td>
<td style="text-align:center">When the process switches to “/bin/ls”, this string is the program argument[0].</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">NULL</td>
<td style="text-align:center">This states the end of the program argument list.</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>E.g. run the command <code>/bin/ls -l</code><ul>
<li>C code: <code>execl(&quot;/bin/ls&quot;, &quot;/bin/ls&quot;, &quot;-l&quot;, NULL);</code></li>
</ul>
</li>
</ul>
<blockquote>
<p><font color="red">Q:</font> Why the origin program ends ? (No “after execl…” printed)</p>
<p><font color="green">A:</font> The program in the address space has been changed.</p>
<p>解释：<code>exec_example</code> 程序调用 <code>execl()</code> 系统调用后，该进程的地址空间存储代码的部分会切换成 <code>execl</code> 中参数指定的程序，而该程序运行结束后不会切换回原来的程序代码，所以进程结束。</p>
</blockquote>
<p>Summary</p>
<ul>
<li>The process is changing the code that is executing and never returns to the original code.<ul>
<li>The last two lines of codes are therefore not executed.</li>
</ul>
</li>
<li>The process that calls an <code>exec</code> system call will replace user space info, e.g.,<ul>
<li>Program Code</li>
<li>Memory: local variables, global variables, and dynamically allocated memory;</li>
<li>Register value: e.g., the program counter;</li>
</ul>
</li>
<li>But, the kernel-space info of that process is preserved, including:<ul>
<li>PID;</li>
<li>Process relationship;</li>
<li>etc.</li>
</ul>
</li>
</ul>
<h3 id="wait"><a href="#wait" class="headerlink" title="wait()"></a><code>wait()</code></h3><blockquote>
<p><font color="green">Recall:</font> previous exmaple with syscall <code>wait()</code> .</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="type">int</span> result;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;before fork...\n&quot;</span>);</span><br><span class="line">  result = fork();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;result = %d&quot;</span>, result);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (result == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m the child.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;My PID is %d.\n&quot;</span>, getpid());</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m the parent.\n&quot;</span>, getpid());</span><br><span class="line">    wait(<span class="literal">NULL</span>);  <span class="comment">// difference here</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;My PID is %d.\n&quot;</span>, getpid())</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Program terminated.\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>wait()</code> called at parent process 👉 if the CPU schedules <font color="red">parent process to run first</font>, then it will wait until child process finished.(like this 👇)</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ ./fork_example</span><br><span class="line">before fork...</span><br><span class="line">result = 1235</span><br><span class="line">I&#x27;m the parent.</span><br><span class="line">result = 0</span><br><span class="line">I&#x27;m the child.</span><br><span class="line">My PID is 1235.</span><br><span class="line">Program terminated.</span><br><span class="line">My PID is 1234.</span><br><span class="line">Program terminated.</span><br></pre></td></tr></table></figure>
<p><img src="/2024/09/13/Operating-Systems/os304.png"></p>
<ul>
<li><code>wait()</code> vs. <code>waitpid()</code><ul>
<li><code>wait()</code><ul>
<li>Wait for any one of the child processes</li>
<li>Detect child <font color="red">termination only</font></li>
</ul>
</li>
<li><code>waitpid()</code><ul>
<li>Depending on the parameters, waitpid() will wait for a particular child only</li>
<li>Depending on the parameters, waitpid() can detect different status changes of the child (resume/stop by a signal)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Kernel-view-of-processes"><a href="#Kernel-view-of-processes" class="headerlink" title="Kernel view of processes"></a>Kernel view of processes</h2><h3 id="PCB"><a href="#PCB" class="headerlink" title="PCB"></a>PCB</h3><p><img src="/2024/09/13/Operating-Systems/os305.png"></p>
<p><img src="/2024/09/13/Operating-Systems/os306.png"></p>
<h3 id="Process-and-Thread"><a href="#Process-and-Thread" class="headerlink" title="Process and Thread"></a>Process and Thread</h3><ul>
<li>One process may have more than one threads (一个进程对多个线程)<ul>
<li>A single-threaded process performs a single thread of execution</li>
<li>A multi-threaded process performs multiple threads of execution <strong>“concurrently”</strong>, thus allowing <strong>short response time</strong> to user’s input even when the main thread is busy</li>
</ul>
</li>
<li>PCB is extended to include information about each thread</li>
</ul>
<p>单线程进程 vs. 多线程进程 👇</p>
<p><img src="/2024/09/13/Operating-Systems/os307.png"></p>
<h3 id="Context-Switch"><a href="#Context-Switch" class="headerlink" title="Context Switch"></a>Context Switch</h3><ul>
<li>Once a process runs on a CPU, it only gives back the control of a CPU<ul>
<li>when it makes a system call</li>
<li>when it raises an exception</li>
<li>when an interrupt occurs</li>
</ul>
</li>
<li>What if none of these would happen for a long time?<ul>
<li>Coorperative scheduling: OS will have to wait<ul>
<li>Early Macintosh OS, old Alto system</li>
</ul>
</li>
<li>Non-coorperative scheduling: timer interrupts<ul>
<li>Modern operating systems</li>
</ul>
</li>
</ul>
</li>
<li>When OS kernel regains the control of CPU<ul>
<li>It first completes the task<ul>
<li>Serve system call, or</li>
<li>Handle interrupt/exception</li>
</ul>
</li>
<li>It then decides which process to run next<ul>
<li>by asking its <strong>CPU scheduler</strong> (in later chapter)</li>
</ul>
</li>
<li>It performs a <strong>context switch</strong> if the soon-to-be-executing process is different from the previous one</li>
</ul>
</li>
</ul>
<p><strong>About context switch</strong></p>
<ul>
<li>During context switch, the system must <strong>save</strong> the state of the old process and <strong>load</strong> the saved state for the new process</li>
<li>Context of a process is represented in the PCB</li>
<li>The time used to do context switch is an overhead of the system; the system does no useful work while switching<ul>
<li>Time of context switch depends on hardware support</li>
<li>Context switch cannot be too frequent</li>
</ul>
</li>
</ul>
<h2 id="Kernel-view-of-fork-exec-and-wait-❗Important"><a href="#Kernel-view-of-fork-exec-and-wait-❗Important" class="headerlink" title="Kernel view of fork(), exec(), and wait() (❗Important)"></a>Kernel view of <code>fork()</code>, <code>exec()</code>, and <code>wait()</code> (❗Important)</h2><h3 id="Overview-1"><a href="#Overview-1" class="headerlink" title="Overview"></a>Overview</h3><p><img src="/2024/09/13/Operating-Systems/os308.png"></p>
<h3 id="fork-Kernel-View"><a href="#fork-Kernel-View" class="headerlink" title="fork(): Kernel View"></a><code>fork()</code>: Kernel View</h3><table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os309.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os310.png"></td>
</tr>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os311.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os312.png"></td>
</tr>
</table>

<ul>
<li>More inside <code>fork()</code> (in kernel view)</li>
<li>After creating the child process(PCB) and allocating user space(Dup’ or CoW), CPU take control to decide which one run first</li>
<li>Both processes store their return value in PCB, ready to return from <code>fork()</code></li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os313.png"></p>
<blockquote>
<p>What if two processes, sharing the same opened file, write to that file together?</p>
</blockquote>
<h3 id="exec-Kernel-View"><a href="#exec-Kernel-View" class="headerlink" title="exec(): Kernel View"></a><code>exec()</code>: Kernel View</h3><p><img src="/2024/09/13/Operating-Systems/os314.png"></p>
<h3 id="wait-and-exit-Kernel-View"><a href="#wait-and-exit-Kernel-View" class="headerlink" title="wait() and exit(): Kernel View"></a><code>wait()</code> and <code>exit()</code>: Kernel View</h3><blockquote>
<p>In user’s view :</p>
</blockquote>
<p><a name="os315"><img src="/2024/09/13/Operating-Systems/os315.png"></a></p>
<blockquote>
<p><code>exit()</code> in kernel view :</p>
</blockquote>
<table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os316.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os317.png"></td>
</tr>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os318.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os319.png"></td>
</tr>
</table>

<ul>
<li>Summary of <code>exit()</code></li>
<li>(1) Clean up most of the allocated kernel-space memory</li>
<li>(2) Clean up the exit process’s user-space memory.</li>
<li>(3) Notify the parent with <code>SIGCHLD</code>.</li>
</ul>
<blockquote>
<p>One problem: How do the two process communicate ? 👉 How does parent receive the signal ?</p>
</blockquote>
<ul>
<li>Brief view on <code>wait()</code></li>
</ul>
<table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os320.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os321.png"></td>
</tr>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os322.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os323.png"></td>
</tr>
</table>


<p>（笔记不全）</p>
<ul>
<li>Case Analysis</li>
<li><strong>I.</strong> Normal case<ul>
<li>Parent call <code>wait()</code>, and then child exit and sent <code>SIGCHLD</code> </li>
</ul>
</li>
<li><p><strong>II.</strong> Parent’s wait() after Child’s exit()</p>
<ul>
<li>This case is okay but the zombie wanders around until <code>wait()</code> is called</li>
</ul>
</li>
<li><p>Using <code>wait()</code> for Resource Management</p>
</li>
<li>It is not only about process execution / suspension …</li>
<li>It is about system resource management.<ul>
<li>A zombie takes up a PID;</li>
<li>The total number of PIDs are limited;<ul>
<li>Read the limit: <code>cat /proc/sys/kernel/pid_max</code></li>
<li>It is 32,768.</li>
</ul>
</li>
<li>What will happen if we don’t clean up the zombies? (maybe the computer cannot run any program.)</li>
</ul>
</li>
</ul>
<h2 id="More-about-processes"><a href="#More-about-processes" class="headerlink" title="More about processes"></a>More about processes</h2><h3 id="The-First-Process"><a href="#The-First-Process" class="headerlink" title="The First Process"></a>The First Process</h3><ul>
<li>We now focus on the process-related events.<ul>
<li>The kernel, while it is booting up, creates the first process – <code>init</code>.</li>
</ul>
</li>
<li>The <code>init</code> process:<ul>
<li>has <code>PID = 1</code>, and</li>
<li>is running the program code <code>/sbin/init</code>.</li>
</ul>
</li>
<li>Its first task is to create more processes …<ul>
<li>Using <code>fork()</code> and <code>exec()</code>.</li>
</ul>
</li>
</ul>
<p><strong>A Tree of Process</strong></p>
<ul>
<li>You can view the tree with the command:<ul>
<li><code>pstree</code>; or</li>
<li><code>pstree –A</code> for ASCII-character-only display.</li>
</ul>
</li>
<li>Problem: What if a parent process (in the process tree) terminates before its children ?<ul>
<li><font color="green">Answer:</font> Using Re-parent</li>
<li>In Linux<ul>
<li>The <code>init</code> process will become the step-mother of all orphans</li>
<li>It’s called re-parenting</li>
</ul>
</li>
<li>In Windows<ul>
<li>It maintains a forest-like process hierarchy </li>
</ul>
</li>
</ul>
</li>
<li>Re-parent Explanation<ul>
<li>exitting parent change all the children’s <strong>parent pointer</strong> to init process</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os324.png" style="zoom:50%"></p>
<ul>
<li>Background Jobs<ul>
<li>The re-parenting operation enables something called background jobs in Linux</li>
<li>It allows a process runs <strong>without a parent terminal/shell</strong></li>
</ul>
</li>
</ul>
<h3 id="Measure-Process-Time"><a href="#Measure-Process-Time" class="headerlink" title="Measure Process Time"></a>Measure Process Time</h3><blockquote>
<p>Two aspect: User Time vs. System Time</p>
</blockquote>
<p><strong>Def.</strong> Real time: whole time to execute the program.</p>
<p><strong>Def.</strong> User time: time to run a user’s code.</p>
<p><strong>Def.</strong> System time: time to run a system’s code.</p>
<ul>
<li>The user time and the sys time together define the performance of an application.<ul>
<li>When writing a program, you must consider both the user time and the sys time.<ul>
<li>E.g., the output of the following two programs are exactly the same. But, their running time is not. (Pro 1 spend much more time to system call)</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pro 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX 1000000</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX; i++)</span><br><span class="line">    <span class="built_in">printf</span>(“x\n”);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Pro 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX 1000000</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; MAX / <span class="number">5</span> ; i++)</span><br><span class="line">    <span class="built_in">printf</span>(“x\nx\nx\nx\nx\n”);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Lec04-CPU-Scheduler"><a href="#Lec04-CPU-Scheduler" class="headerlink" title="Lec04. CPU Scheduler"></a>Lec04. CPU Scheduler</h1><h2 id="Outline-2"><a href="#Outline-2" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Scheduler Concept</li>
<li>Different Scheduling Algorithm</li>
<li>Optimization</li>
</ul>
<h2 id="Scheduler-Concept"><a href="#Scheduler-Concept" class="headerlink" title="Scheduler Concept"></a>Scheduler Concept</h2><ul>
<li>Scheduling is important when multiple processes wish to run on a single CPU<ul>
<li>CPU scheduler decides which process to run next</li>
</ul>
</li>
<li>Two types of processes<ul>
<li>CPU bound and I/O bound</li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">CPU bound</th>
<th style="text-align:center">I/O bound</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Def</td>
<td style="text-align:center">Spends most of its running time on the CPU, i.e., <code>user-time -&gt; sys-time</code></td>
<td style="text-align:center">Spends most of its running time on I/O, i.e., <code>sys-time -&gt; user-time</code></td>
</tr>
<tr>
<td style="text-align:center">E.g.</td>
<td style="text-align:center">AI course assignments.</td>
<td style="text-align:center"><code>/bin/ls</code>, networking programs</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>CPU scheduler selects one of the processes that are ready to execute and allocates the CPU to it</li>
<li>CPU scheduling decisions may take place when a process:<ol>
<li>Switches from running to waiting state</li>
<li>Switches from running to ready state</li>
<li>Switches from waiting to ready</li>
<li>Terminates</li>
</ol>
</li>
</ul>
<p><strong>Scheduling Algorithm Optimization Criteria</strong></p>
<ul>
<li>Given a set of processes, with <ul>
<li><strong>Arrival time:</strong> the time they arrive in the CPU ready queue (from waiting state or from new state) </li>
<li><strong>CPU requirement:</strong> their expected CPU burst time</li>
</ul>
</li>
<li>Minimize average turnaround time<ul>
<li><strong>Turnaround time:</strong> The time between the arrival of the task and the time it is blocked or terminated.</li>
</ul>
</li>
<li>Minimize average waiting time<ul>
<li><strong>Waiting time:</strong> The accumulated time that a task has waited in the ready queue.</li>
</ul>
</li>
<li>Reduce the number of context switches</li>
</ul>
<h2 id="Different-Algorithm"><a href="#Different-Algorithm" class="headerlink" title="Different Algorithm"></a>Different Algorithm</h2><h3 id="Shortest-Job-First-SJF"><a href="#Shortest-Job-First-SJF" class="headerlink" title="Shortest Job First (SJF)"></a>Shortest Job First (SJF)</h3><blockquote>
<p>定义：字面意思</p>
<p>Type</p>
<ul>
<li>Non-preemptive</li>
<li>Preemptive</li>
</ul>
</blockquote>
<ul>
<li>Non-preemptive SJF<ul>
<li>when new process arrive ready queue, the scheduler won’t step in immediately (until the current process blocked or terminated)</li>
<li>when scheduler steps in, it selects next task based on <strong>remaining CPU requirement</strong></li>
</ul>
</li>
<li>Preemptive SJF<ul>
<li>whenever a new process arrive ready queue, the scheduler steps in and selects the next task based on <strong>remaining CPU requirement</strong></li>
</ul>
</li>
</ul>
<h3 id="Round-robin-RR"><a href="#Round-robin-RR" class="headerlink" title="Round-robin (RR)"></a>Round-robin (RR)</h3><ul>
<li>Preemptive<ul>
<li>Every process given a <strong>quantum</strong> (the amount of time allowed to execute)</li>
<li>when a process’s quantum used up, the process is preempted, placed at the end of the queue, with its quantum recharge</li>
<li>then, <strong>the scheduler step in</strong> and choose the next process</li>
</ul>
</li>
<li>New process add to the tail of ready queue<ul>
<li>but won’t trigger a new selection decision</li>
</ul>
</li>
</ul>
<blockquote>
<p>一个调度是否抢占，在 RR 中看的是触发调度时正在运行的进程是否已经执行完毕。</p>
</blockquote>
<h3 id="Priority-scheduling"><a href="#Priority-scheduling" class="headerlink" title="Priority scheduling"></a>Priority scheduling</h3><ul>
<li>A <strong>priority number</strong> (integer) is associated with each process</li>
<li>The CPU is allocated to the process with the highest priority (smallest integer $equiv$ highest priority)<ul>
<li>Nonpreemptive: newly arrived process simply put into the queue</li>
<li>Preemptive: if the priority of the newly arrived process is higher than priority of the currently running process, <strong>preempt the CPU</strong></li>
</ul>
</li>
<li>Static priority and dynamic priority<ul>
<li>static priority: fixed priority throughout its lifetime</li>
<li>dynamic priority: priority changes over time</li>
</ul>
</li>
<li>SJF is a priority scheduling where priority is the next CPU burst time</li>
</ul>
<ul>
<li>Problem: Starvation —— low priority process may never execute</li>
<li>Solution: Aging —— as time progresses increase the priority of the process<ul>
<li>在等待队列待得越久，优先级越高，后续越容易被调度运行</li>
</ul>
</li>
</ul>
<h2 id="Optimization-Completely-Fair-Scheduler"><a href="#Optimization-Completely-Fair-Scheduler" class="headerlink" title="Optimization: Completely Fair Scheduler"></a>Optimization: Completely Fair Scheduler</h2><ul>
<li>Scheduling class<ul>
<li>Standard Linux kernel implements two scheduling classes</li>
<li>(1) Default scheduling class: CFS</li>
<li>(2) Real-time scheduling class</li>
</ul>
</li>
<li>Varying length scheduling quantum<ul>
<li>Traditional UNIX scheduling uses 90ms fixed scheduling quantum</li>
<li>CFS assigns a proposition of CPU processing time to each task</li>
</ul>
</li>
<li>Nice value<ul>
<li>$-20$ to $+19$, default nice is 0</li>
<li>Lower nice value indicates a higher relative priority</li>
<li>Higher value is “being nice” (“够好了，不用这么多时间运行了”)</li>
<li>Task with lower nice value receives higher proportion of CPU time</li>
</ul>
</li>
<li>Virtual run time<ul>
<li>Each task has a per-task variable vruntime</li>
<li>Decay factor<ul>
<li>Lower priority has higher rate of decay </li>
<li>nice = 0 virtual run time is identical to actual physical run time</li>
<li>A task with nice $&gt; 0$ runs for 200 milliseconds, its vruntime will be higher than 200 milliseconds</li>
<li>A task with nice $\lt 0$ runs for 200 milliseconds, its vruntime will be lower than 200 milliseconds</li>
</ul>
</li>
</ul>
</li>
<li>Lower virtual run time, higher priority<ul>
<li>To decide which task to run next, scheduler chooses the task that has the smallest vruntime value</li>
<li>Higher priority can preempt lower priority</li>
</ul>
</li>
</ul>
<p><strong>Example</strong></p>
<ul>
<li>Example: Two tasks have the same nice value</li>
<li>One task is I/O bound and the other is CPU bound</li>
<li><strong>vruntime</strong> of I/O bound will be shorter than <strong>vruntime</strong> of CPU bound</li>
<li>I/O bound task will eventually have higher priority and preempt CPU-bound tasks whenever it is ready to run</li>
</ul>
<h1 id="Lec05-Synchronization"><a href="#Lec05-Synchronization" class="headerlink" title="Lec05. Synchronization"></a>Lec05. Synchronization</h1><h2 id="Outline-3"><a href="#Outline-3" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Process Communications: Race Condition and Mutual Exclusion</li>
<li>Solution Implementation: Critical Section</li>
<li>Spin-based Lock</li>
<li>Sleep-based Lock</li>
</ul>
<h2 id="Process-Communications"><a href="#Process-Communications" class="headerlink" title="Process Communications"></a>Process Communications</h2><ul>
<li>Threads of the same process share the same address space<ul>
<li>Global variables are shared by multiple threads</li>
<li>Communication between threads made easy</li>
</ul>
</li>
<li>Process may also need to communicate with each other<ul>
<li>Information sharing: <ul>
<li>e.g., sharing between Android apps</li>
</ul>
</li>
<li>Computation speedup: <ul>
<li>e.g., Message Passing Interface (MPI)</li>
</ul>
</li>
<li>Modularity and isolation: <ul>
<li>e.g., Chrome’s multi-process architecture</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Problems-Synchronization-of-Threads-Processes"><a href="#Problems-Synchronization-of-Threads-Processes" class="headerlink" title="Problems: Synchronization of Threads/Processes"></a>Problems: Synchronization of Threads/Processes</h3><blockquote>
<p><strong>A Joke:</strong> A programmer had a problem. He thought to himself, “I know, I’ll solve it with threads!”. has Now problems. two he</p>
</blockquote>
<h3 id="Race-Condition"><a href="#Race-Condition" class="headerlink" title="Race Condition"></a>Race Condition</h3><table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os501.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os502.png"></td>
</tr>
</table>

<ul>
<li>The above scenario is called the race condition.<ul>
<li>May happen whenever “shared object” + “multiple processes/threads” + “concurrently”</li>
</ul>
</li>
<li>A race condition means<ul>
<li>The outcome of an execution depends on a particular order in which the shared resource is accessed.</li>
</ul>
</li>
<li>Remember: race condition is always a bad thing and debugging race condition is a nightmare!</li>
</ul>
<h2 id="Solution-Critical-Section"><a href="#Solution-Critical-Section" class="headerlink" title="Solution: Critical Section"></a>Solution: Critical Section</h2><p><img src="/2024/09/13/Operating-Systems/os503.png"></p>
<p><strong>Def.</strong> <font color="red">Mutual Exclusion</font> is when one process access the shared memory, no one else could access it.</p>
<p><strong>Implementation: Critical Section</strong></p>
<table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os504.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os505.png"></td>
</tr>
</table>

<ul>
<li>A critical section is the code segment that access shared objects.<ul>
<li>Critical section should be as tight as possible.<ul>
<li>Well, you can set the entire code of a program to be a big critical section.</li>
<li>But, the program will have a very high chance to block other processes or to be blocked by other processes.</li>
</ul>
</li>
<li>Note that one critical section can be designed for accessing more than one shared objects.</li>
</ul>
</li>
<li>Critical Section Implementation<ul>
<li>Requirement #1. Mutual Exclusion<ul>
<li>No two processes could be simultaneously go inside their own critical sections.</li>
</ul>
</li>
<li>Requirement #2. Bounded Waiting<ul>
<li>Once a process starts trying to enter its critical section, there is a bound on the number of times other processes can enter theirs.</li>
</ul>
</li>
<li>Requirement #3. Progress <ul>
<li>Say no process currently in critical section.</li>
<li>One of the processes trying to enter will eventually get in</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Solution-Disabling-Interrupts"><a href="#Solution-Disabling-Interrupts" class="headerlink" title="Solution: Disabling Interrupts"></a>Solution: Disabling Interrupts</h3><p><img src="/2024/09/13/Operating-Systems/os506.png"></p>
<h2 id="Solution-Spin-based-Locks"><a href="#Solution-Spin-based-Locks" class="headerlink" title="Solution: Spin-based Locks"></a>Solution: Spin-based Locks</h2><h3 id="Overview-about-Locks"><a href="#Overview-about-Locks" class="headerlink" title="Overview about Locks"></a>Overview about Locks</h3><ul>
<li>Use yet another shared objects: locks<ul>
<li>What about race condition on lock? </li>
<li>Atomic instructions: instructions that cannot be “interrupted”, not even by instructions running on another core</li>
</ul>
</li>
<li>Spin-based locks<ul>
<li>Process synchronization<ul>
<li>Basic spinning using 1 shared variable</li>
<li>Peterson’s solution: Spin using 2 shared variables</li>
</ul>
</li>
<li>Thread synchronization: pthread_spin_lock</li>
</ul>
</li>
<li>Sleep-based locks<ul>
<li>Process synchronization: POSIX semaphore</li>
<li>Thread synchronization: pthread_mutex_lock</li>
</ul>
</li>
</ul>
<h3 id="Spin-based-lock"><a href="#Spin-based-lock" class="headerlink" title="Spin-based lock"></a>Spin-based lock</h3><p><img src="/2024/09/13/Operating-Systems/os507.png"></p>
<ul>
<li>Consider the following sequence:<ul>
<li>Process0 leaves <code>cs()</code>, set <code>turn=1</code></li>
<li>Process1 enters <code>cs()</code>, leaves <code>cs()</code>, set <code>turn=0</code>, work on remainder_section_slow</li>
<li>Process0 loops back and enters <code>cs()</code> again, leaves <code>cs()</code>, set <code>turn=1</code></li>
<li>Process0 finishes its <code>remainder_section()</code>, go back to top of the loop<ul>
<li>It can’t enter its <code>cs()</code> (as turn = 1)</li>
<li>That is, process0 gets blocked, but Process1 is outside its <code>cs()</code>,  it is at its <code>remainder_section_slow()</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os508.png"></p>
<h3 id="Improvement-Peterson’s-Solution"><a href="#Improvement-Peterson’s-Solution" class="headerlink" title="Improvement: Peterson’s Solution"></a>Improvement: Peterson’s Solution</h3><blockquote>
<p>引入了一个“兴趣”机制</p>
</blockquote>
<table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os509.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os510.png"></td>
</tr>
</table>



<ul>
<li>Mutual exclusion<ul>
<li><code>interested[0] == interested[1] == true</code></li>
<li><code>turn == 0</code> or <code>turn == 1</code>, not both</li>
</ul>
</li>
<li>Progress<ul>
<li>If only $P_0$ to enter critical section<ul>
<li><code>interested[1] == false</code>, thus $P_0$ enters critical section</li>
</ul>
</li>
<li>If both $P_0$ and $P_1$ to enter critical section<ul>
<li><code>interested[0] == interested[1] == true</code> and (<code>turn == 0</code> or <code>turn == 1</code>)</li>
<li>One of $P_0$ and $P_1$ will be selected</li>
</ul>
</li>
</ul>
</li>
<li><font color="red">Bounded-waiting</font> <ul>
<li>If both $P_0$ and $P_1$ to enter critical section, and $P_0$ selected first</li>
<li>When $P_0$ exit, <code>interested[0] = false</code><ul>
<li>If $P_1$ runs fast: <code>interested[0] == false</code>, $P_1$ enters critical section</li>
<li>If $P_0$ runs fast: <code>interested[0] = true</code>, but <code>turn = 0</code>, $P_1$ enters critical section.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Multi-Process-Mutual-Exclusion"><a href="#Multi-Process-Mutual-Exclusion" class="headerlink" title="Multi-Process Mutual Exclusion"></a>Multi-Process Mutual Exclusion</h4><blockquote>
<ul>
<li>初始化一个 waiting array 表示 n 个进程，<code>lock == TRUE</code></li>
<li>当一个进程（e.g. process <code>i</code>）离开 critical section 时，它会从 <code>i+1</code> 开始遍历整个 waiting array</li>
<li>第一个被扫描到 <code>waiting[j] == TRUE</code> 的进程将会进入critical section</li>
<li>实现 Bounded-waiting：所有进程最多经过 $n-1$ 次即可进入 critical section</li>
<li>当不再有进程进入 critical section 时，<code>lock == FALSE</code> </li>
</ul>
</blockquote>
<h4 id="Priority-Inversion"><a href="#Priority-Inversion" class="headerlink" title="Priority Inversion"></a>Priority Inversion</h4><p><img src="/2024/09/13/Operating-Systems/os511.png"></p>
<blockquote>
</blockquote>
<h2 id="Solution-Sleep-based-Locks"><a href="#Solution-Sleep-based-Locks" class="headerlink" title="Solution: Sleep-based Locks"></a>Solution: Sleep-based Locks</h2><ul>
<li>Semaphore is just a struct, which includes <ul>
<li>an integer that counts the # of resources available<ul>
<li>Can do more than solving mutual exclusion</li>
</ul>
</li>
<li>a wait-list</li>
</ul>
</li>
<li>The trick is still the section entry/exit function implementation<ul>
<li>Must involve kernel (for sleep)</li>
<li>Implement uninterruptable section entry/exit<ul>
<li>Disable interrupts (on single core)</li>
<li>Atomic instructions (on multiple cores)</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// definition of sema&#x27;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">int</span> value;</span><br><span class="line">  <span class="built_in">list</span> process_id;</span><br><span class="line">&#125; semaphore;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// example of sema&#x27;</span></span><br><span class="line"><span class="comment">/* wait */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sem_wait</span><span class="params">(semaphore *s)</span>&#123;</span><br><span class="line">  s-&gt;value = s-&gt;value - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( s-&gt;value &lt; <span class="number">0</span> ) &#123;</span><br><span class="line">    sleep();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* post */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">sem_post</span><span class="params">(semaphore *s)</span> &#123;</span><br><span class="line">  s-&gt;value = s-&gt;value + <span class="number">1</span>;    </span><br><span class="line">  <span class="keyword">if</span> ( s-&gt;value &lt;= <span class="number">0</span> ) wakeup();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>See an example 👇</li>
</ul>
<table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os512.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os513.png"></td>
</tr>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os514.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os515.png"></td>
</tr>
</table>

<ul>
<li>Origin value of semaphore represent the capacity of preemptive processes (<code>init=1</code>, allowing at most $1$ process to take the resource)</li>
<li>Now process 1357 is running and take the resource (locked)</li>
<li>when process 1234 arrives, value of semaphore became $-1$, so process 1234 sleep and wait.</li>
<li>Process 1357 exit critical section and return the resource, calling wakeup to set value of semaphore to $0$, so that process 1234 can take the resource.</li>
</ul>
<h3 id="Problems-solved-by-semaphore"><a href="#Problems-solved-by-semaphore" class="headerlink" title="Problems solved by semaphore"></a>Problems solved by semaphore</h3><ul>
<li>Producer-Consumer Problem<ul>
<li>Two types of processes: producer<ul>
<li>At least one producer and one consumer.</li>
</ul>
</li>
</ul>
</li>
<li>Dining Philosopher Problem<ul>
<li>Only one type of process<ul>
<li>At least two processes.</li>
</ul>
</li>
</ul>
</li>
<li>Reader Writer Problem<ul>
<li>Multiple readers, one write</li>
</ul>
</li>
</ul>
<h4 id="Producer-Consumer-Problem"><a href="#Producer-Consumer-Problem" class="headerlink" title="Producer-Consumer Problem"></a>Producer-Consumer Problem</h4><p><img src="/2024/09/13/Operating-Systems/os516.png"></p>
<ul>
<li>Requirement #1: Producer wants to put a new item in the buffer, but the buffer is already full<ul>
<li>The producer should wait</li>
<li>The consumer should notify the producer after it has dequeued an item</li>
</ul>
</li>
<li>Requirement #2: Consumer wants to consume an item from the buffer, but the buffer is empty<ul>
<li>Then consumer should wait</li>
<li>The producer should notify the consumer after it has enqueued an item</li>
</ul>
</li>
</ul>
<blockquote>
<p>How to implement (solve) ?</p>
</blockquote>
<ul>
<li>The problem can be divided into two sub-problems.<ul>
<li><strong>Mutual exclusion</strong> with <strong>one binary semaphore</strong><ul>
<li>The buffer is a shared object.  </li>
</ul>
</li>
<li><strong>Synchronization</strong> with <strong>two counting semaphores</strong><ul>
<li>Notify  the producer to stop producing when the buffer is full<ul>
<li>In other words, notify the producer to produce when the buffer is NOT full</li>
</ul>
</li>
<li>Notify the consumer to stop eating when the buffer is empty<ul>
<li>In other words, notify the consumer to consume when the buffer is NOT empty</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os517.png"></p>
<ul>
<li><strong>Q1:</strong> Can we only use <code>avail</code> and remove <code>fill</code> ?<ul>
<li>producer <code>avail--</code> by wait</li>
<li>consumer <code>avail++</code> by post</li>
</ul>
</li>
<li><strong>A1:</strong> No. If consumer get CPU first, it removes item from NULL [Error!].</li>
<li><strong>Q2:</strong> Can we switch line 6 and 7 in producer ? (wait for <code>mutex</code> first)</li>
<li><strong>A2:</strong> Consider such a case:<ul>
<li>The buffer is full.</li>
<li>Producer wait at line 7 (wait for consumer to remove items)</li>
<li>Context switch.</li>
<li>Consumer pass line 5 but wait at line 6 (wait for producer to post &amp;mutex)</li>
<li>Now both producer and consumer wait for each other</li>
</ul>
</li>
<li>This scenario is called a <strong>deadlock</strong></li>
</ul>
<h4 id="Dining-Philosopher-Problem"><a href="#Dining-Philosopher-Problem" class="headerlink" title="Dining Philosopher Problem"></a>Dining Philosopher Problem</h4><p><img src="/2024/09/13/Operating-Systems/os518.png"></p>
<blockquote>
<p>两个要求：</p>
<ol>
<li>不能偷筷子，且两人不能同时用一根筷子（mutual exclusion）</li>
<li>必须避免死锁（每个人都拿了一根筷子，都吃不了东西）</li>
</ol>
<p>初步实现：</p>
<ol>
<li>一个人拿起一根筷子，如果另一根无法拿起（被占），则放下全部筷子并休息（sleep），被唤醒后再尝试</li>
</ol>
<p>问题：可能导致全部人都重复这个操作，最后还是谁都吃不了东西</p>
<p>Final Solution: 👇</p>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os519.png"></p>
<p>a case:</p>
<table>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os520.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os521.png"></td>
</tr>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os522.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os523.png"></td>
</tr>
<tr>
<td><img src="/2024/09/13/Operating-Systems/os524.png"></td>
<td><img src="/2024/09/13/Operating-Systems/os525.png"></td>
</tr>
</table>



<h1 id="Lec06-Address-Translation"><a href="#Lec06-Address-Translation" class="headerlink" title="Lec06. Address Translation"></a>Lec06. Address Translation</h1><h2 id="Outline-4"><a href="#Outline-4" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Memory Virtualization</li>
<li>Base &amp; Bounds</li>
<li>Segmentation</li>
<li>Memory Allocation</li>
</ul>
<h2 id="Memory-Virtualization"><a href="#Memory-Virtualization" class="headerlink" title="Memory Virtualization"></a>Memory Virtualization</h2><blockquote>
<p>Multiprogramming with Memory Partition brings problems to physical memory</p>
</blockquote>
<h3 id="Address-Space"><a href="#Address-Space" class="headerlink" title="Address Space"></a>Address Space</h3><p><img src="/2024/09/13/Operating-Systems/os601.png"></p>
<p><img src="/2024/09/13/Operating-Systems/os602.png"></p>
<ul>
<li>A mechanism that virtualize memory should<ul>
<li>Be transparent<ul>
<li>Memory virtualization should be invisible to processes</li>
<li>Processes run as if on a single private memory</li>
</ul>
</li>
<li>Be efficient<ul>
<li>Time: translation is fast</li>
<li>Space: not too space consuming</li>
</ul>
</li>
<li>Provide protection<ul>
<li>Enable memory isolation</li>
<li>One process may not access memory of another process or the OS kernel</li>
<li>Isolation is a key principle in building reliable systems</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Address-Translation"><a href="#Address-Translation" class="headerlink" title="Address Translation"></a>Address Translation</h3><p><img src="/2024/09/13/Operating-Systems/os603.png"></p>
<h2 id="Base-amp-Bound"><a href="#Base-amp-Bound" class="headerlink" title="Base &amp; Bound"></a>Base &amp; Bound</h2><p><img src="/2024/09/13/Operating-Systems/os604.png"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Hardware Support</th>
<th style="text-align:center">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Privileged mode to update base/bounds</td>
<td style="text-align:center">Needed to prevent user-mode processes from executing privileged operations to update base/bounds</td>
</tr>
<tr>
<td style="text-align:center">Base/bounds registers</td>
<td style="text-align:center">Need pair of registers per CPU to support address translation and bounds checks</td>
</tr>
<tr>
<td style="text-align:center">Privileged instruction(s) to register exception handlers</td>
<td style="text-align:center">Need to allow OS, but not the processes, to tell hardware what exception handlers code to run if exception occurs</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">OS Support</th>
<th style="text-align:center">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Memory management</td>
<td style="text-align:center">Need to allocate memory for new processes; Reclaim memory from terminated processes; manage memory via free list</td>
</tr>
<tr>
<td style="text-align:center">Base/bounds management</td>
<td style="text-align:center">Must set base/bounds properly upon context switch</td>
</tr>
<tr>
<td style="text-align:center">Exception handling</td>
<td style="text-align:center">Code to run when exceptions arise; likely action is to terminate offending process</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Limitation"><a href="#Limitation" class="headerlink" title="Limitation"></a>Limitation</h3><ul>
<li><font color="red">Internal fragmentation</font> .<ul>
<li>wasted memory between heap and stack </li>
</ul>
</li>
<li><font color="red">Cannot support larger address space</font> .<ul>
<li>Address space equals the allocated slot in memory </li>
<li><font color="blue">E.g. Process C’s address space is at most 64KB</font> .</li>
</ul>
</li>
<li><font color="red">Hard to do inter-process sharing</font> .<ul>
<li>Want to share code segments when possible </li>
<li>Want to share memory between processes </li>
<li><font color="blue">E.g. Process A &amp; C cannot share memory</font> .</li>
</ul>
</li>
</ul>
<h2 id="Segmentation-Generalized-Base-Bounds"><a href="#Segmentation-Generalized-Base-Bounds" class="headerlink" title="Segmentation: Generalized Base/Bounds"></a>Segmentation: Generalized Base/Bounds</h2><p><img src="/2024/09/13/Operating-Systems/os605.png"></p>
<h3 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h3><ul>
<li>Base/bounds registers organized as a table<ul>
<li>Segment ID used to index the base/bounds pair</li>
<li>Base added to offset (of virtual address) to generate physical address</li>
<li>Error check catches offset (of virtual address) out of range</li>
</ul>
</li>
<li>Use segments explicitly<ul>
<li>Segment addressed by top bits of virtual address</li>
</ul>
</li>
<li>Use segments implicitly<ul>
<li>e.g., code segment used for code fetching</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os606.png"></p>
<ul>
<li>Memory sharing with segmentation<ul>
<li>Code sharing on modern OS is very common</li>
<li>If multiple processes use the same program code or library code<ul>
<li>Their address space may overlap in the physical memory</li>
<li>The cooresponding segments have the same base/bounds</li>
</ul>
</li>
<li>Memory sharing needs memory protection</li>
</ul>
</li>
<li>Memory protection with segmentation<ul>
<li>Extend base/bounds register pair</li>
<li>Read/Write/Execute permission</li>
</ul>
</li>
</ul>
<p><strong>Problems with Segmentation</strong></p>
<ul>
<li>OS context switch must also save and restore all pairs of segment registers</li>
<li>A segment may grow, which may or may not be possible</li>
<li>Management of free spaces of physical memory with variable sized segments</li>
<li>External fragmentation: gaps between allocated segments<ul>
<li>Segmentation may also have internal fragmentation if more space allocated than needed. (一个 seg 内的 heap 和 stack 之间存在内部碎片，浪费了过多分配的空间)</li>
</ul>
</li>
</ul>
<h2 id="Memory-Allocation"><a href="#Memory-Allocation" class="headerlink" title="Memory Allocation"></a>Memory Allocation</h2><ul>
<li>OS needs to manage all free physical memory regions</li>
<li>A basic solution is to maintain a <strong>linked list</strong> of free slots</li>
<li>An ideal allocation algorithm is both <em>fast and minimizes fragmentation</em>. (sometimes need trade-off)</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os607.png" style="zoom:40%"></p>
<h3 id="Some-Strategies"><a href="#Some-Strategies" class="headerlink" title="Some Strategies"></a>Some Strategies</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Strategy</th>
<th style="text-align:left">Idea</th>
<th style="text-align:left">Pros</th>
<th style="text-align:left">Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Best fit</td>
<td style="text-align:left"><ul><li>search through the free list and find chunks of free memory that are as big or bigger than the requested size.</li><li>return the one that is the <b>smallest</b> in that group of candidates;</li></ul></td>
<td style="text-align:left">Satisfy the request with minimal external fragmentation</td>
<td style="text-align:left">exhaustive search is slow</td>
</tr>
<tr>
<td style="text-align:center">Worst fit</td>
<td style="text-align:left"><ul><li>search through the free list and find chunks of free memory that are as big or bigger than the requested size.</li><li>return the one that is the <b>largest</b> in that group of candidates;</li></ul></td>
<td style="text-align:left">Leaves larger “holes” in physical memory</td>
<td style="text-align:left"><ul><li>exhaustive search is slow</li><li>severe fragmentation in practice</li></ul></td>
</tr>
<tr>
<td style="text-align:center">First fit</td>
<td style="text-align:left">find the first block that is big enough and returns the requested size</td>
<td style="text-align:left">Fast</td>
<td style="text-align:left">pollutes the beginning of the free list with small chunks</td>
</tr>
</tbody>
</table>
</div>
<h1 id="Lec07-Paging"><a href="#Lec07-Paging" class="headerlink" title="Lec07. Paging"></a>Lec07. Paging</h1><h2 id="Outline-5"><a href="#Outline-5" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Introduction to paging</li>
<li>Multi-level page tables</li>
<li>Other page table structures</li>
<li>Real-world paging schemes</li>
<li>Translation lookaside buffer (<strong>TLB</strong>)</li>
</ul>
<h2 id="Intro-to-Paging"><a href="#Intro-to-Paging" class="headerlink" title="Intro to Paging"></a>Intro to Paging</h2><blockquote>
<p><font color="green">Recall:</font> Solutions on segmentation</p>
</blockquote>
<ul>
<li>Physical memory conceptually divided into <font color="red">fixed size</font><ul>
<li>Each is a <font color="red">page frame</font><ul>
<li>Too big → internal fragmentation</li>
<li>Too small → page table too big</li>
</ul>
</li>
</ul>
</li>
<li>Virtual address space conceptually divided into the same size<ul>
<li>Each is a <font color="red">page</font></li>
</ul>
</li>
<li>Page mapped to page frame<ul>
<li>One-to-one mapping</li>
<li>Many-to-one mapping 👉 memory sharing</li>
</ul>
</li>
<li>One page table per process<ul>
<li>Resides in physical memory<ul>
<li>One entry for one virtual $\to$ physical translation</li>
</ul>
</li>
</ul>
</li>
</ul>
<table><tr>
<td><img src="/2024/09/13/Operating-Systems/os701.png" style="zoom:60%"></td>
<td><img src="/2024/09/13/Operating-Systems/os702.png" style="zoom:60%"></td></tr>
<tr><td><img src="/2024/09/13/Operating-Systems/os703.png" style="zoom:60%"></td>
<td><img src="/2024/09/13/Operating-Systems/os704.png" style="zoom:60%"></td>
</tr></table>

<ul>
<li><strong>Virtual Address and Paging</strong><ul>
<li>Length of virtual address determines size of address space </li>
<li>Length of offset determines size of a page / page frame</li>
<li>In case of m-bit virtual address and k-bit offset<ul>
<li>Size of address space: $2^m$ </li>
<li>Size of a page: $2^k$</li>
<li>e.g., 32-bit virtual address, 4KB page: $m = 32$, $k = 12$</li>
</ul>
</li>
</ul>
</li>
<li><strong>Page Table Entry</strong><ul>
<li>An entry in the page table is called a page table entry (<strong>PTE</strong>).</li>
<li>Besides <strong>PFN</strong> (Page Frame Number), <strong>PTE</strong> also contains a <font color="red">valid bit</font><ul>
<li>Virtual pages with no valid mapping: valid bit = 0</li>
<li>Important for sparse address space (e.g., $2^{64}$ bytes)</li>
</ul>
</li>
<li>PTE also contains <font color="red">protection bits</font><ul>
<li>Permission to read from or write, or execute code on this page</li>
</ul>
</li>
<li>PTE also contains <font color="red">an access bit, a dirty bit, a present bit</font><ul>
<li>Present bit: whether this page is in physical memory or on disk</li>
<li>Dirty bit: whether the page has been modified since it was brought into memory</li>
<li>Access bit: whether a page has been accessed</li>
</ul>
</li>
</ul>
</li>
</ul>
<table><tr>
<td><img src="/2024/09/13/Operating-Systems/os705.png" style="zoom:60%"></td>
<td><img src="/2024/09/13/Operating-Systems/os706.png" style="zoom:60%"></td>
</tr></table>



<h2 id="Multi-level-page-tables"><a href="#Multi-level-page-tables" class="headerlink" title="Multi-level page tables"></a>Multi-level page tables</h2><ul>
<li>Two level Page Tables<ul>
<li>in order to save space</li>
<li>using “Tree” instead of “List” to improve performance</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os707.png" style="zoom:60%"></p>
<blockquote>
<p>More detail about …</p>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os708.png" style="zoom:60%"></p>
<h2 id="Other-Page-Table-Strctures"><a href="#Other-Page-Table-Strctures" class="headerlink" title="Other Page Table Strctures"></a>Other Page Table Strctures</h2><ul>
<li>Hierarchical page tables <ul>
<li>2-level page tables</li>
<li>3-level page tables</li>
<li>4-level page tables</li>
</ul>
</li>
<li>Hashed Page Tables </li>
<li>Inverted Page Tables</li>
</ul>
<h2 id="Real-world-Paging-Scheme"><a href="#Real-world-Paging-Scheme" class="headerlink" title="Real-world Paging Scheme"></a>Real-world Paging Scheme</h2><p><strong>I.</strong> RISC-V support multiple MMU</p>
<ul>
<li><code>RV32</code> : SV32</li>
<li><code>RV64</code> : SV39 &amp; SV48</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os709.png"></p>
<p><strong>II.</strong> IA-32 (Intel’s 32-bit CPU) uses two stage address translation: segmentation + paging</p>
<p><strong>Issues of Paging</strong></p>
<ul>
<li>Time Complexity<ul>
<li>Extra memory references during address translation</li>
<li>Three-level page tables requires 3 additional memory reads</li>
</ul>
</li>
</ul>
<h2 id="Translation-Lookaside-Buffer"><a href="#Translation-Lookaside-Buffer" class="headerlink" title="Translation Lookaside Buffer"></a>Translation Lookaside Buffer</h2><ul>
<li>A <font color="red">translation lookaside buffer (TLB)</font> is a hardware cache that is part of the MMU (Memory Management Unit)<ul>
<li>A cache for the PTEs: holding a translation likely to be <strong>re-used</strong><ul>
<li>Replacement policy: <strong>LRU</strong> (Recall for “Computer Organization”), FIFO, random</li>
</ul>
</li>
<li>Each entry holds mapping of a virtual address to a physical address</li>
</ul>
</li>
<li>Before a virtual-to-physical address translation is to be performed, TLB is looked up using VPN<ul>
<li>TLB hit: VPN is found, and the PFN of the same entry used</li>
<li>TLB miss: VPN not found, page table walk</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os710.png" style="zoom:60%"></p>
<center>TLB hit</center>

<p><img src="/2024/09/13/Operating-Systems/os711.png" style="zoom:60%"></p>
<center>TLB miss</center>



<blockquote>
<p>Thought: can TLB be big?</p>
<p>No. If it’s too big, it cannot function as speed-up.</p>
</blockquote>
<ul>
<li><strong>Issues with Context Switch</strong><ul>
<li>Two process may use the same virtual address<ul>
<li>e.g. <code>P1: 100-&gt;170</code>, <code>P2: 100-&gt;110</code></li>
</ul>
</li>
<li>Solutions: <ul>
<li>Flush TLB upon context switch (Invalidate all entries: <code>V-&gt;I</code>)</li>
<li>Extending TLB with address space ID (No need to flush TLB)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Lec08-Demand-Paging"><a href="#Lec08-Demand-Paging" class="headerlink" title="Lec08. Demand Paging"></a>Lec08. Demand Paging</h1><h2 id="Outline-6"><a href="#Outline-6" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Demand Paging Mechanisms</li>
<li>Page Replacement Policy</li>
<li>Page Frame Allocation</li>
</ul>
<h2 id="Demand-Paging-Mechanisms"><a href="#Demand-Paging-Mechanisms" class="headerlink" title="Demand Paging Mechanisms"></a>Demand Paging Mechanisms</h2><blockquote>
<p>Who is responsible for moving data?</p>
<p>For applications, it’s <strong>memory overlay</strong></p>
<ul>
<li>Application in charge of moving data between memory and disk</li>
<li>e.g., calling a function needs to make sure the code is in memory!</li>
</ul>
<p>For OS, it’s <strong>demand paging</strong></p>
<ul>
<li>OS configures page table entries</li>
<li>Virtual page maps to physical memory or files in disk</li>
<li>Process sees an abstraction of address space</li>
<li>OS determines where the data is stored</li>
</ul>
</blockquote>
<h3 id="Swap-Space"><a href="#Swap-Space" class="headerlink" title="Swap Space"></a>Swap Space</h3><ul>
<li>Swap space is a partition or a file stored on the disk<ul>
<li>OS swaps pages out of memory to it </li>
</ul>
</li>
<li>OS swaps pages from it into memory<ul>
<li>Swap space conceptually divided into page-sized units</li>
<li>OS maintains a disk address of each page-sized unit</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os801.png" style="zoom:60%"></p>
<h3 id="Demand-Paging"><a href="#Demand-Paging" class="headerlink" title="Demand Paging"></a>Demand Paging</h3><ul>
<li>Load pages from disk to memory only as they are needed <ul>
<li>Pages are loaded “on demand”</li>
</ul>
</li>
<li>Data transferred in the unit of pages</li>
<li>Two possible on-disk locations <ul>
<li>Swap space: <ul>
<li>created by OS for temporary storage of pages on disk</li>
<li>e.g., pages for stack and heap</li>
</ul>
</li>
<li>Program binary files:<ul>
<li>The code pages from this binary are only loaded into memory when they are executed</li>
<li>Read-only, thus never write back</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Physical Memory as a Cache</strong></p>
<ul>
<li>Physical memory can be regarded as a cache of on-disk swap space</li>
<li>Block size of the cache?<ul>
<li>1 page (4KB)</li>
</ul>
</li>
<li>Cache organization (direct-mapped, set-associative, fully-associative)?<ul>
<li>Fully associative: any disk page maps to any page frame</li>
</ul>
</li>
<li>What is page replacement policy?<ul>
<li>LRU, Random, FIFO</li>
</ul>
</li>
<li>What happens on a miss?<ul>
<li>Go to lower level to fill page (i.e. disk)</li>
</ul>
</li>
<li>What happens on a write, write-through or write back?<ul>
<li>write-back: changes are written back to disk when page is evicted <font color="green">(Recall for Computer Organization)</font></li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os802.png"></p>
<ul>
<li>Using a present bit to indicate whether a page is in physical memory</li>
</ul>
<h4 id="Page-Fault"><a href="#Page-Fault" class="headerlink" title="Page Fault"></a>Page Fault</h4><ul>
<li>Present bit = 0 raises a <strong>page fault</strong><ul>
<li>OS gets involved in address translation</li>
</ul>
</li>
<li>Page fault handler<ul>
<li>(1) Find free page frame in physical memory</li>
<li>(2) Fetch page from disk and store it in physical memory</li>
</ul>
</li>
<li>After page fault<ul>
<li>Return from page fault exception</li>
<li>CPU re-execute the instruction that accesses the virtual memory</li>
<li>No more page fault since present bit is set this time</li>
<li>TLB entry loaded from PTE</li>
</ul>
</li>
</ul>
<p><strong>(1) Find free page frame in physical memory</strong></p>
<ul>
<li>Find one free page frame from a free-page list</li>
<li>If no free page, trigger <font color="red">page replacement</font><ul>
<li>find a page frame to be replaced<ul>
<li><font color="red">Page replacement</font> policy decides which one to replace</li>
</ul>
</li>
<li>If page frame to be replaced is dirty, write it back to disk</li>
<li>Update all PTEs pointing to the page frame</li>
<li>Invalidate all TLB entries for these PTEs</li>
</ul>
</li>
</ul>
<p><strong>(2) Fetch page from disk</strong></p>
<ul>
<li>Determine the faulting virtual address from register</li>
<li>Locate the disk address of the page in PTE (where PFN should be stored)<ul>
<li>It is a very natural choice to make use of the space in PTE</li>
</ul>
</li>
<li>Issues a request to disk to fetch the page into memory</li>
<li>Wait …… (could be a very long time, context switch!)</li>
<li>When I/O completes, update page table entry: PFN, present bit</li>
</ul>
<blockquote>
<p><strong>Q: When to Trigger Page Replacement?</strong></p>
<ul>
<li>Proactive page replacement usually leads to better performance<ul>
<li>Page replacement even though no one needs free page frames (yet)</li>
<li>Always reserve some free page frames in the system</li>
</ul>
</li>
<li>Swap daemon<ul>
<li>background process for reclaiming page frames</li>
<li>Low watermark: a threshold to trigger swap deamon</li>
<li>High watermark: a threshold to stop reclaiming page frames</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os803.png"></p>
<h2 id="Page-Replacement-Policy"><a href="#Page-Replacement-Policy" class="headerlink" title="Page Replacement Policy"></a>Page Replacement Policy</h2><h3 id="Effective-Access-Time-EAT"><a href="#Effective-Access-Time-EAT" class="headerlink" title="Effective Access Time (EAT)"></a>Effective Access Time (EAT)</h3><blockquote class="blockquote-center">
<p>$<br>EAT=\text{ Hit Rate }\times \text{ Hit Time }+ \text{ Miss Rate }\times \text{ Miss Penalty }<br>$</p>

</blockquote>
<p><strong>Three types of Cache Misses</strong></p>
<ul>
<li>Compulsory Misses: <ul>
<li>Cold-start miss: pages that have never been fetched into memory before</li>
<li>Prefetching: loading them into memory before needed</li>
</ul>
</li>
<li>Capacity Misses:<ul>
<li>Not enough memory: must somehow increase available memory size</li>
<li>One option: Increase amount of DRAM (not quick fix!)</li>
<li>Another option:  If multiple processes in memory: adjust percentage of memory allocated to each one!</li>
</ul>
</li>
<li>Conflict Misses:<ul>
<li>fully-associative cache (OS page cache) does not have conflict misses</li>
</ul>
</li>
</ul>
<h3 id="Page-Replacement-Policies"><a href="#Page-Replacement-Policies" class="headerlink" title="Page Replacement Policies"></a>Page Replacement Policies</h3><ul>
<li>Optimal (also called MIN): <ul>
<li>Replace page that will not be used for the longest time</li>
<li>Lead to minimum page faults in theory</li>
<li><font color="grey">But OS won’t know about the future</font>.</li>
</ul>
</li>
<li>FIFO (First In, First Out)<ul>
<li>Throw out oldest page first</li>
<li>May throw out heavily used pages instead of infrequently used</li>
</ul>
</li>
<li>RANDOM:<ul>
<li>Pick random page for every replacement</li>
<li>Pretty unpredictable – makes it hard to make real-time guarantees</li>
</ul>
</li>
<li>Least Recently Used (LRU):<ul>
<li>Replace page that has not been used for the longest time</li>
<li>Temporal locality of program</li>
<li>If a page has not been used for a while, it is unlikely to be used in the near future</li>
<li><font color="grey">Seem to be practical, huh</font>?</li>
</ul>
</li>
<li>Least Frequently Used (LFU)<ul>
<li>Replace page that has not been accessed many times</li>
<li>Spatial locality of program</li>
<li>if a page has been accessed many times, perhaps it should not be replaced as it clearly has some value. (Like LRU)</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Bélády’s Anomaly</strong></p>
<p>When you add memory the miss rate drops in LRU and MIN, but not necessarily for <strong>FIFO</strong> !</p>
</blockquote>
<h3 id="LRU-Impl"><a href="#LRU-Impl" class="headerlink" title="LRU Impl"></a>LRU Impl</h3><ul>
<li>Hardware support is necessary<ul>
<li>Update a data structure in OS upon every memory access</li>
<li>E.g., a timestamp counter for each page frame</li>
</ul>
</li>
<li>Overhead (LRU 实现需要考虑以下负载)<ul>
<li>One additional memory write for each memory access<ul>
<li>TLB hit does not save the extra memory access</li>
</ul>
</li>
<li>Scan the entire memory to find the LRU one<ul>
<li>4GB physical memory has 1 million page frames</li>
<li>sorting is time consuming</li>
</ul>
</li>
</ul>
</li>
<li>LRU Approximation with Reference Bit:<ul>
<li>Reference bit<ul>
<li>One reference bit per page frame</li>
<li>All bits are cleared to 0 initially</li>
<li>The first time a page is referenced, the reference bit is set by CPU (Can be integrated with page table walk)</li>
<li>The order of page accesses approximated by two clusters: used and unused pages</li>
</ul>
</li>
<li>E.g. Clock algorithm(second-chance algorithm), enhanced clock algorithm with dirty bits</li>
</ul>
</li>
</ul>
<h3 id="Clock-Algorithm"><a href="#Clock-Algorithm" class="headerlink" title="Clock Algorithm"></a>Clock Algorithm</h3><p><img src="/2024/09/13/Operating-Systems/os804.png"></p>
<blockquote>
<p>提供了一次“避免被替换”的机会</p>
</blockquote>
<ul>
<li>Clock Algorithm with Dirty Bit<ul>
<li>dirty bit = 1: the page has recently been modified</li>
</ul>
</li>
<li>CPU sets dirty bit to 1 upon <strong>write</strong> access</li>
<li>When a replacement occurs, OS checks <code>(ref bit, dirty bit)</code>, and selects a candidate page in decreasing order<ul>
<li><code>(0, 0)</code> neither recently used nor modified — best page to replace </li>
<li><code>(0, 1)</code> not recently used but modified — not quite as good, because the page will need to be written out before replacement </li>
<li><code>(1, 0)</code> recently used but clean — probably will be used again soon </li>
<li><code>(1, 1)</code> recently used and modified — probably will be used again soon, and the page will be need to be written out to secondary storage before it can be replaced</li>
</ul>
</li>
<li><font color="red"><b>Renew:</b></font> LRU Approximation with Reference Bit and Counter<ul>
<li>Reference bit indicate recent access<ul>
<li><font color="red">set by CPU hardware, cleared by OS</font>.</li>
</ul>
</li>
<li>Counter records history of accesses<ul>
<li>Maintained by OS</li>
</ul>
</li>
<li>Two counter example 👇</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os805.png"></p>
<h2 id="Page-Frame-Allocation"><a href="#Page-Frame-Allocation" class="headerlink" title="Page Frame Allocation"></a>Page Frame Allocation</h2><ul>
<li>How do we allocate memory among different processes?<ul>
<li>Does every process get the same fraction of memory?  Different fractions?</li>
<li>Should we completely swap some processes out of memory?</li>
</ul>
</li>
<li>Minimum number of pages per process<ul>
<li>Depends on the computer architecture</li>
<li>How many pages would one instruction use at one time<ul>
<li>x86 only allows data movement between memory and register and no indirect reference</li>
<li>needs at least one instruction page, one data page, and some page table pages</li>
</ul>
</li>
</ul>
</li>
<li>Maximum number of pages per process<ul>
<li>Depends on available physical memory</li>
</ul>
</li>
</ul>
<p><strong>Global vs. Local Allocation</strong></p>
<ul>
<li>Global replacement: One process can take a frame from another process</li>
<li>Local replacement: Each process selects from only its own set of allocated frames</li>
</ul>
<h3 id="Allocation-Algorithms"><a href="#Allocation-Algorithms" class="headerlink" title="Allocation Algorithms"></a>Allocation Algorithms</h3><ul>
<li>Equal allocation: <ul>
<li>Every process gets same amount of memory</li>
<li>Example: 100 frames, 5 processes $\to$ each process gets 20 frames</li>
</ul>
</li>
<li>Proportional allocation<ul>
<li>Number of page frames proportional to the size of process</li>
<li>$s_i =$ size of process $p_i$ and $m =$ total number of frame</li>
<li>$a_i =$ allocation for $p_i =m\times \frac{s_i}{\sum{s_j}}$</li>
</ul>
</li>
<li>Priority Allocation:<ul>
<li>Number of page frames proportional to the priority of process</li>
<li>Possible behavior: If process $p_i$ generates a page fault, select for replacement a frame from a process with lower priority number</li>
</ul>
</li>
</ul>
<blockquote>
<p>Thrashing</p>
<p>The memory demands of the set of running processes simply exceeds the available physical memory</p>
<p>Early OS: pages used actively of a process, and reduce # of process</p>
<p>Modern OS: Out-of-memory killer when memory is oversubscribed (need reboot)</p>
</blockquote>
<h1 id="Lec09-Linux-Memory-Management"><a href="#Lec09-Linux-Memory-Management" class="headerlink" title="Lec09. Linux Memory Management"></a>Lec09. Linux Memory Management</h1><h2 id="Outline-7"><a href="#Outline-7" class="headerlink" title="Outline"></a>Outline</h2><h2 id="Address-Space-in-Linux"><a href="#Address-Space-in-Linux" class="headerlink" title="Address Space in Linux"></a>Address Space in Linux</h2><p><img src="/2024/09/13/Operating-Systems/os901.png"></p>
<ul>
<li>Each page split into 3:1 (alike) portions, e.g., 3/4 for user mode and 1/4 for kernel space.</li>
</ul>
<blockquote>
<p>Q: Why is kernel memory mapped into the address space of each process?</p>
<ul>
<li>No need to change page table (i.e., switch CR3) when trapped into the kernel (no TLB flush)</li>
<li>Kernel code may access user memory when needed</li>
</ul>
</blockquote>
<p>Aware! —— The kernel memory in each address space is <font color="red">the same</font></p>
<p><img src="/2024/09/13/Operating-Systems/os902.png" style="zoom:70%"></p>
<ul>
<li>Linux adds supports to huge page (Linux term)<ul>
<li>Fewer TLB misses</li>
<li>Applications may need physically continuous physical memory</li>
<li>Leads to internal fragmentation</li>
</ul>
</li>
</ul>
<h2 id="Slab-Allocator"><a href="#Slab-Allocator" class="headerlink" title="Slab Allocator"></a>Slab Allocator</h2><p><img src="/2024/09/13/Operating-Systems/os908.png"></p>
<ul>
<li>When a slab is allocated to a cache, objects are initialized and marked as free</li>
<li>A slab can be in one of the following states:<ul>
<li>empty: all objects are free</li>
<li>partial: some objects are free</li>
<li>full: all objects are used</li>
</ul>
</li>
<li>A request is first served by a partial slab, then empty slab, then a new slab can be allocated from buddy system (buddy system 会介绍如何被分配到一个全新的 slab 中)</li>
<li>No memory is wasted due to <strong>fragmentation</strong><ul>
<li>when an object is requested, the slab allocator returns the exact amount of memory required to represent the object </li>
<li>Objects are packed tightly in the slab</li>
</ul>
</li>
<li>Memory requests can be satisfied <strong>quickly</strong><ul>
<li>Objects are created and initiated in advance </li>
<li>Freed object is marked as free and immediately available for subsequent requests </li>
</ul>
</li>
<li>Later Linux kernel also introduces <em>Slub allocator</em> and <em>Slob allocators</em>.</li>
</ul>
<h2 id="Buddy-System"><a href="#Buddy-System" class="headerlink" title="Buddy System"></a>Buddy System</h2><ul>
<li>Free physical memory is considered big space of size $2^N$ pages</li>
<li><strong>Allocation:</strong> the free space is divided by two until a block that is big enough to accommodate the request is found<ul>
<li>a further split would result in a space that is too small</li>
</ul>
</li>
<li><strong>Free:</strong> the freed block is recursively merged with its buddy<ul>
<li>Two <strong>buddy blocks</strong> have physical addresses that differ only in <strong>1 bit</strong></li>
<li>e.g. following example: page size = 4 KB</li>
</ul>
</li>
</ul>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os903.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os904.png"></td>
</tr>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os905.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os906.png"></td>
</tr>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os907.png"></td>
    <td>Note that two <b>buddy system</b> differ at bit i (where they separate, e.g., A and B at the lowest bit) on their <b>PFN</b></td>
</tr>
</table>



<h1 id="Lec10-I-O"><a href="#Lec10-I-O" class="headerlink" title="Lec10. I/O"></a>Lec10. I/O</h1><h2 id="Outline-8"><a href="#Outline-8" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>I/O Management &amp; View of Device</li>
<li>Basic I/O: Polling</li>
<li>Efficient I/O: Interrupts</li>
<li>Data Movement</li>
<li>Device Driver</li>
</ul>
<h2 id="I-O-Management-amp-View-of-Device"><a href="#I-O-Management-amp-View-of-Device" class="headerlink" title="I/O Management &amp; View of Device"></a>I/O Management &amp; View of Device</h2><ul>
<li>Challenges of I/O management<ul>
<li>Diverse devices: each device is slightly different<ul>
<li>How can we standardize the interfaces to these devices?</li>
</ul>
</li>
<li>Unreliable device: media failures and transmission errors<ul>
<li>How can we make them reliable?</li>
</ul>
</li>
<li>Unpredictable and slow devices<ul>
<li>How can we manage them if we do not know what they will do or how they will perform?</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1001.png" style="zoom:70%"></p>
<p><strong>A Canonical View of Devices</strong></p>
<ul>
<li>Interface<ul>
<li>The hardware interface a device present to the rest of the system</li>
<li><strong>Status registers</strong>: check the current status of the device</li>
<li><strong>Command register</strong>: tell the device to perform a certain task</li>
<li><strong>Data register</strong>: pass data to the device or get data from the device. </li>
</ul>
</li>
<li>Internal structures<ul>
<li>Implementation of the abstract of the device</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1002.png" style="zoom:70%"></p>
<h2 id="Basic-I-O-Polling"><a href="#Basic-I-O-Polling" class="headerlink" title="Basic I/O: Polling"></a>Basic I/O: Polling</h2><ol>
<li>OS waits until the device is ready to receive a command by <strong>repeatedly reading</strong> the status register;</li>
<li>OS sends some data down to the data register;</li>
<li>OS writes a command to the command register;</li>
<li>OS waits for the device to finish by <strong>again polling</strong> it in a loop, waiting to see if it is finished.</li>
</ol>
<ul>
<li>Issues<ul>
<li>frequent checking the status of I/O devices</li>
<li>inefficient and inconvenient<ul>
<li>Polling wastes CPU time waiting for slow devices to complete its activity </li>
<li>If CPU switches to other tasks, data may be overwritten (CPU 内数据改变，导致写入设备的数据出错)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Efficient-I-O-Interrupts"><a href="#Efficient-I-O-Interrupts" class="headerlink" title="Efficient I/O: Interrupts"></a>Efficient I/O: Interrupts</h2><ul>
<li>Idea<ul>
<li>Put the calling process to sleep, and context switch to another task.</li>
<li>When the device is finally finished with the operation, it will <strong>raise a hardware interrupt</strong>, causing the CPU to jump into the OS at a <strong>predetermined interrupt handler</strong></li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1003.png"></p>
<ul>
<li>Comparison<ul>
<li>Polling works better for fast devices<ul>
<li>Data fetched with first poll</li>
</ul>
</li>
<li>Interrupt works better for slow devices<ul>
<li>Context switch is expensive</li>
</ul>
</li>
</ul>
</li>
<li>Hybird approach if speed of the device is not known or unstable<ul>
<li>Polls for a while</li>
<li>Then use interrupts</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1004.png"></p>
<blockquote>
<p>Others related to <strong>Interrupt</strong>:</p>
<p>System call is made by executing a special instruction called software interrupts to trigger kernel to execute request</p>
<p>Multi-CPU systems can process interrupts concurrently</p>
</blockquote>
<h2 id="Data-Movement"><a href="#Data-Movement" class="headerlink" title="Data Movement"></a>Data Movement</h2><h3 id="Programmed-I-O"><a href="#Programmed-I-O" class="headerlink" title="Programmed I/O"></a>Programmed I/O</h3><ul>
<li>Explicit I/O instructions<ul>
<li>in/out instructions on x86: <code>out 0x21,AL</code></li>
<li>I/O instructions are privileged instructions</li>
</ul>
</li>
<li>Memory-mapped I/O<ul>
<li>Registers/memory appear in physical address space</li>
<li>I/O accomplished with load and store instructions</li>
<li>I/O protection with address translation</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1005.png"></p>
<h3 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h3><p><strong>Def.</strong> Direct Memory Access</p>
<ul>
<li>DMA is used to avoid programmed I/O for large data movement <ul>
<li>Programmed I/O (PIO): when CPU is involved in data movement</li>
<li>PIO consumes CPU time</li>
<li>bypasses CPU to transfer data directly between I/O device and memory </li>
</ul>
</li>
<li>OS writes DMA command block into memory <ul>
<li>Source and destination addresses</li>
<li>Read or write mode</li>
<li>Count of bytes</li>
<li>Writes location to DMA controller</li>
<li>Bus mastering of DMA controller – grabs bus from CPU<ul>
<li><strong>Cycle stealing</strong> from CPU but still much more efficient</li>
</ul>
</li>
<li>When done, interrupts to signal completion</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1006.png"></p>
<h2 id="Device-Driver"><a href="#Device-Driver" class="headerlink" title="Device Driver"></a>Device Driver</h2><p><strong>Def.</strong> Device-specific <font color="red">code in the kernel</font> that interacts directly with the device hardware, which support a standard, internal interface.</p>
<p>Special device-specific configuration supported with the <code>ioctl()</code> system call</p>
<ul>
<li>Two pieces of Device Driver:<ul>
<li><strong>Top half:</strong> accessed in call path from system calls <ul>
<li>implements a set of standard, cross-device calls like <code>open()</code>, <code>close()</code>, <code>read()</code>, <code>write()</code>, <code>ioctl()</code>, <code>strategy()</code>.</li>
<li>This is the kernel’s interface to the device driver</li>
<li>Top half will start I/O to device, may put thread to sleep until finished</li>
</ul>
</li>
<li><strong>Bottom half:</strong> run as interrupt routine<ul>
<li>Gets input or transfers next block of output</li>
<li>May wake sleeping threads if I/O now complete</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Life-Cycle-of-an-I-O-Request"><a href="#Life-Cycle-of-an-I-O-Request" class="headerlink" title="Life Cycle of an I/O Request"></a>Life Cycle of an I/O Request</h3><p><img src="/2024/09/13/Operating-Systems/os1007.png"></p>
<h3 id="Different-types-of-device"><a href="#Different-types-of-device" class="headerlink" title="Different types of device"></a>Different types of device</h3><table><tr>
    <td><img src="/2024/09/13/Operating-Systems/os1008.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os1009.png"></td>
</tr></table>




<h1 id="Lec11-Storage"><a href="#Lec11-Storage" class="headerlink" title="Lec11. Storage"></a>Lec11. Storage</h1><h2 id="Outline-9"><a href="#Outline-9" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Storage Devices</li>
<li>Disk Scheduling</li>
</ul>
<h2 id="Storage-Devices"><a href="#Storage-Devices" class="headerlink" title="Storage Devices"></a>Storage Devices</h2><ul>
<li>Magnetic disks<ul>
<li>Storage that rarely becomes corrupted</li>
<li>Large capacity at low cost</li>
<li>Block level random access</li>
<li>Poor performance for random access</li>
<li>Better performance for <strong>sequential access</strong></li>
</ul>
</li>
<li>Flash memory<ul>
<li>Storage that rarely becomes corrupted</li>
<li>Capacity at intermediate cost (5-20x disk)</li>
<li>Block level random access</li>
<li>Good performance for <strong>reads</strong>; worse for random writes</li>
</ul>
</li>
</ul>
<h3 id="Concepts-for-Magnetic-Disk"><a href="#Concepts-for-Magnetic-Disk" class="headerlink" title="Concepts for Magnetic Disk"></a>Concepts for Magnetic Disk</h3><ul>
<li>Sector: Unit of Transfer<ul>
<li>Ring of sectors form a track</li>
<li>Stack of tracks form a cylinder (disk)</li>
<li>Heads (磁头) position on cylinders (to read data)</li>
</ul>
</li>
<li>Disk Tracks $\approx 1\mu m$ wide</li>
<li>Separated by unused guard regions<ul>
<li>avoid corrupted in writes</li>
</ul>
</li>
</ul>
<h3 id="Calculation-Time-of-read-write"><a href="#Calculation-Time-of-read-write" class="headerlink" title="Calculation: Time of read/write"></a>Calculation: Time of read/write</h3><p><strong>Three types of delay</strong></p>
<ul>
<li><strong>Seek time:</strong> position the head/arm over the proper track</li>
<li><strong>Rotational latency:</strong> wait for desired sector to rotate under r/w head</li>
<li><p><strong>Transfer time:</strong> transfer a block of bits (sector) under r/w head</p>
</li>
<li><p>Assumptions:</p>
<ul>
<li>Ignoring queuing and controller times for now</li>
<li>Avg seek time of 5ms, </li>
<li>7200RPM $\Rightarrow$ Time for rotation: 60000 (ms/minute) / 7200(rev/min) $\cong$ 8ms</li>
<li>Transfer rate 4MByte/s, sector size 1 Kbyte $\Rightarrow$ 1024 bytes / 4 $\times 10^{6}$(bytes/s) $=$256 $\times 10^{-6}$ sec $=$ 0.256 ms</li>
</ul>
</li>
<li>Read from random place of disk: use avg rot. latency:<ul>
<li>Seek (5ms) + Rot. Delay (4ms) + Transfer (0.26ms) $\approx 10ms$ for a sector</li>
</ul>
</li>
</ul>
<blockquote>
<p>Now Magnetic  Disks are gradually replaced by SSDs(Solid State Disks)</p>
</blockquote>
<h2 id="Disk-Scheduling"><a href="#Disk-Scheduling" class="headerlink" title="Disk Scheduling"></a>Disk Scheduling</h2><blockquote>
<p>OS should think how to use hardware efficiently?</p>
<p>Try to reduce <strong>seek time</strong> !</p>
<p>How to minimize the total head movement distance?</p>
<ul>
<li>Given a sequence of access cylinders in the HDD<ul>
<li>98, 183, 37, 122, 14, 124, 65, 67</li>
<li>Head point: 53</li>
<li>Pages: 0 ~ 199</li>
</ul>
</li>
</ul>
<p>See how different scheduling algorithms work.</p>
</blockquote>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1101.png"><br>FIFO (First in First out)</td>
    <td><img src="/2024/09/13/Operating-Systems/os1102.png"><br>SSTF (Shortest Seek Time First)</td>
</tr>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1103.png"><br>SCAN (elevator algo')</td>
    <td><img src="/2024/09/13/Operating-Systems/os1104.png"><br>C-SCAN</td>
</tr>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1105.png"><br>LOOK, C-LOOK</td>
</tr>
</table>

<ul>
<li>Explanations<ul>
<li>In C-SCAN, when the head move to one end (e.g. 199), it immediately turn to another end (e.g. 0), and won’t cost the seek time (no 199 - 0)</li>
<li>The LOOK scheduling is improvement based on SCAN, and C-LOOK based on LOOK and C-SCAN. Both of the LOOK scheduling cost extra “look” time, but they have better performance (the head no need to go to the end)</li>
<li>C-LOOK only have one-direction service request, but it have best performance among these schedulings.</li>
</ul>
</li>
</ul>
<h1 id="Lec12-File-System"><a href="#Lec12-File-System" class="headerlink" title="Lec12. File System"></a>Lec12. File System</h1><h2 id="Outline-10"><a href="#Outline-10" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>File System Basic</li>
<li>Contiguous Allocation</li>
<li>Linked Allocation</li>
<li>iNode Allocation</li>
<li>Ext 2/3/4</li>
</ul>
<h2 id="File-System-Basic"><a href="#File-System-Basic" class="headerlink" title="File System Basic"></a>File System Basic</h2><p><strong>Def.</strong> Layer of OS that transforms block interface of disks (or other block devices) into Files, Directories, etc.</p>
<ul>
<li>File System Components<ul>
<li><strong>Naming</strong>: Interface to find files by name, not by blocks</li>
<li><strong>Disk Management</strong>: collecting disk blocks into files</li>
<li><strong>Protection</strong>: Layers to keep data secure</li>
<li><strong>Reliability/Durability</strong>: Keeping of files durable despite crashes, media failures, attacks, etc.</li>
</ul>
</li>
<li>Directory<ul>
<li><font color="red">A hierarchical structure</font>.</li>
<li>Each DIR’ entry is a collection of <ul>
<li>Files</li>
<li>Directories<ul>
<li>a link to another entry</li>
</ul>
</li>
</ul>
</li>
<li>Each has a name and attributes<ul>
<li>files have data</li>
</ul>
</li>
<li>Links (hard links, 类似快捷方式) make it a DAG (有向无环图), not just a tree<ul>
<li>Softlinks (类似副本) are another name for an entry</li>
</ul>
</li>
</ul>
</li>
<li>File<ul>
<li><font color="red">Named permanent storage</font>.</li>
<li>Contains<ul>
<li>Data</li>
<li>Metadata (Attributes)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Contiguous-Allocation"><a href="#Contiguous-Allocation" class="headerlink" title="Contiguous Allocation"></a>Contiguous Allocation</h2><blockquote>
<p>Easy to understand.</p>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os1201.png"></p>
<ul>
<li>Good for locate file and delete file</li>
<li><font color="red">Bad for create</font>!<ul>
<li>External Fragmentation take response for it.</li>
<li>Defragmentation process may help, but it’s expensive (data movement on disk)!</li>
</ul>
</li>
</ul>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1202.png"><br>Before</td>
</tr><tr>
    <td><img src="/2024/09/13/Operating-Systems/os1203.png"><br>After</td>
</tr>
</table>

<ul>
<li>Usage today<ul>
<li>ISO 9660 (光盘映射文件)</li>
<li>CV-ROM (no writing)</li>
</ul>
</li>
</ul>
<h2 id="Linked-Allocation"><a href="#Linked-Allocation" class="headerlink" title="Linked Allocation"></a>Linked Allocation</h2><p><strong>Step (1).</strong> Chop the storage device and data into <font color="red">equal sized blocks</font>.</p>
<p><strong>Step (2).</strong> Fill the empty space in a <font color="red">block-by-block manner</font>.</p>
<p><strong>Step (3).</strong> Leave 4 bytes from each block as “pointer” to next block of the same file. But still keep the file size in root directory table (facilitates <code>ls -l</code> etc. which lists file size)</p>
<p><img src="/2024/09/13/Operating-Systems/os1204.png"></p>
<h3 id="Comparison-to-contiguous-allocation"><a href="#Comparison-to-contiguous-allocation" class="headerlink" title="Comparison to contiguous allocation"></a>Comparison to contiguous allocation</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">Contiguous alloc</th>
<th style="text-align:center">Linekd alloc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Fragmentation</td>
<td style="text-align:center">External Fragmentation</td>
<td style="text-align:center">Internal Fragmentation (not all files are multiple of block size)</td>
</tr>
<tr>
<td style="text-align:center">Random access</td>
<td style="text-align:center">good performance</td>
<td style="text-align:center">Bad performance(e.g. if I want 900th block, I have to go through previous 899.)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="FAT"><a href="#FAT" class="headerlink" title="FAT"></a>FAT</h3><ul>
<li>Solution to the Poor performance of random access:<ul>
<li>File Allocation Table (<strong>FAT</strong>)</li>
<li>Turning the 4 bytes at the head of each block to a table besides Root Directory<ul>
<li>can only search for the table to get random access.</li>
</ul>
</li>
</ul>
</li>
<li>In DOS, a block is called a “cluster”.<ul>
<li>The cluster address length equals to the block address</li>
<li>Calculation: Given block size (e.g. 32 KB) and block address (e.g. 28 bits), we can know about the <strong>File System size</strong><ul>
<li>$fss=32\times 2^{10} \times 2^{28}=2^{43}\text{ Bytes}=8\text{ TB}$</li>
</ul>
</li>
</ul>
</li>
<li>What is more complex 👇</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1205.png"></p>
<h4 id="Header-of-file-name"><a href="#Header-of-file-name" class="headerlink" title="Header of file name"></a>Header of file name</h4><ul>
<li>Compare format difference from Normal DIR entry and LFN (Long File Name) entry</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1206.png"></p>
<blockquote>
<p>How does LFN really work when a long file name occur ? 👇</p>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os1207.png" style="zoom:50%"></p>
<h4 id="About-FAT-reading-appending-and-deleting-files"><a href="#About-FAT-reading-appending-and-deleting-files" class="headerlink" title="About FAT reading, appending and deleting files"></a>About FAT reading, appending and deleting files</h4><p>I. Reading</p>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1208.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os1209.png"></td>
</tr>
</table>

<p>II. Appending data</p>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1210.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os1211.png"></td>
</tr>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1212.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os1213.png"></td>
</tr>
</table>

<p>III. Deleting files</p>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1214.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os1215.png"></td>
</tr>
</table>

<ul>
<li>Lazy delete<ul>
<li>“Deleted data” persists until the de-allocated clusters are reused.</li>
<li>Efficient but insecure (in multi-user system).</li>
</ul>
</li>
</ul>
<h2 id="iNode"><a href="#iNode" class="headerlink" title="iNode"></a>iNode</h2><ul>
<li>Original iNode format appeared in BSD 4.1<ul>
<li>Berkeley Standard Distribution Unix</li>
<li>Similar structure for Linux Ext2/3</li>
</ul>
</li>
<li>File Number is index of iNode arrays</li>
<li>Multi-level index structure<ul>
<li>Great for little and large files</li>
<li>Unbalanced tree with fixed sized blocks</li>
</ul>
</li>
<li>Metadata associated with the file<ul>
<li>Rather than in the directory that points to it</li>
</ul>
</li>
<li>Scalable directory structure</li>
</ul>
<blockquote>
<p>不同于 FAT 将所有文件指针放在一起，iNode 的单位是文件/文件夹。每个文件（夹）对应一个 iNode。（格式见下图）</p>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os1217.png"></p>
<blockquote>
<p>而索引（存储）方式则是用一个 iNode array 进行存储</p>
<p>而指针采用非平衡树状数据结构（如下图）</p>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os1216.png"></p>
<blockquote>
<p>Also see how to calculate File size based on given info.</p>
</blockquote>
<p><img src="/2024/09/13/Operating-Systems/os1218.png"></p>
<h2 id="Ext-2-3-4"><a href="#Ext-2-3-4" class="headerlink" title="Ext 2 / 3 / 4"></a>Ext 2 / 3 / 4</h2><blockquote>
<p>The latest default FS for Linux distribution is the Fourth <font color="blue">Extended File System</font>, Ext4 for short.</p>
</blockquote>
<h3 id="Ext-2-3"><a href="#Ext-2-3" class="headerlink" title="Ext 2/3"></a>Ext 2/3</h3><ul>
<li>For Ext 2/3:<ul>
<li>Block size: 1024, 2048, 4096 bytes</li>
<li>Block address size: 4 bytes $\Rightarrow$ # of block addresses $=2^{32}$</li>
</ul>
</li>
<li>So their File System Size = 4 TB, 8 TB and 16 TB</li>
<li><strong>Structure</strong><ul>
<li>divided into <strong>block groups</strong> (each block group like this 👇)</li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1219.png"></p>
<ul>
<li>Block Bitmap tells which data block is allocated</li>
<li>iNode Bitmap tells if an iNode is allocated</li>
</ul>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1220.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os1221.png"></td>
</tr>
</table>

<blockquote>
<p>File deletion is just an update of the “entry length” of the previous entry.</p>
</blockquote>
<h3 id="Hard-amp-Soft-link"><a href="#Hard-amp-Soft-link" class="headerlink" title="Hard &amp; Soft link"></a>Hard &amp; Soft link</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Properties</th>
<th style="text-align:center">Hard Link</th>
<th style="text-align:center">Symbolic Link</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Creation</td>
<td style="text-align:center">Link to the same iNode (may have different file name)</td>
<td style="text-align:center">create a new iNode</td>
</tr>
<tr>
<td style="text-align:center">when link is deleted</td>
<td style="text-align:center">Reference counter decrease(target delete at 0)</td>
<td style="text-align:center">Target unchanged</td>
</tr>
<tr>
<td style="text-align:center">when target is moved</td>
<td style="text-align:center">remain valid</td>
<td style="text-align:center">link invalid</td>
</tr>
<tr>
<td style="text-align:center">Relative path</td>
<td style="text-align:center">N/A</td>
<td style="text-align:center">less than 60 characters(12 direct block and 3 indirect) is allowed</td>
</tr>
<tr>
<td style="text-align:center">Crossing filesystem boundaries</td>
<td style="text-align:center">Not supported(target must be on same filesystem)</td>
<td style="text-align:center">Supported</td>
</tr>
</tbody>
</table>
</div>
<h1 id="Lec13-Deadlock"><a href="#Lec13-Deadlock" class="headerlink" title="Lec13. Deadlock"></a>Lec13. Deadlock</h1><h2 id="Outline-11"><a href="#Outline-11" class="headerlink" title="Outline"></a>Outline</h2><h2 id="Deadlock-Basic"><a href="#Deadlock-Basic" class="headerlink" title="Deadlock Basic"></a>Deadlock Basic</h2><p><img src="/2024/09/13/Operating-Systems/os1301.png"></p>
<ul>
<li>4 Requirements for Deadlock<ul>
<li>Mutual exclusion<ul>
<li>Only one thread at a time can use a resource.</li>
</ul>
</li>
<li>Hold and wait<ul>
<li>Thread holding at least one resource is waiting to acquire additional resources held by other threads</li>
</ul>
</li>
<li>No preemption<ul>
<li>Resources are released only voluntarily by the thread holding the resource, after thread is finished with it</li>
</ul>
</li>
<li>Circular wait<ul>
<li>There exists a set $\{T_1, …, T_n \}$ of waiting threads</li>
<li>$T_1$ is waiting for a resource that is held by $T_2$</li>
<li>$T_2$ is waiting for a resource that is held by $T_3$</li>
<li>…</li>
<li>$T_n$ is waiting for a resource that is held by $T_1$</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Two-ways-to-handle-deadlock"><a href="#Two-ways-to-handle-deadlock" class="headerlink" title="Two ways to handle deadlock"></a>Two ways to handle deadlock</h2><blockquote>
<p>Of course you can directly ignore it (like UNIX), but we are going to talk about 2 methods which truly handle it.</p>
</blockquote>
<h3 id="Deadlock-detection-with-Resource-Allocation-Graphs"><a href="#Deadlock-detection-with-Resource-Allocation-Graphs" class="headerlink" title="Deadlock detection with Resource Allocation Graphs"></a>Deadlock detection with Resource Allocation Graphs</h3><ol>
<li>If there is only one type of resource, go searching for cycle.</li>
<li>If there are multiple types of resource, we have to firstly represent the resource:<ul>
<li><strong>Available</strong>: A vector of length $m$ indicates the number of available resources of each type.</li>
<li><strong>Allocation</strong>: An $n \times m$ matrix defines the number of resources of each type currently allocated to each process.</li>
<li><strong>Request</strong>: An $n \times m$ matrix indicates the current request  of each process.  If Request $[i_j] = k$, then process $P_i$ is requesting $k$ more instances of resource type $R_j$. (Request-based)</li>
</ul>
</li>
</ol>
<blockquote>
<p>Suppose m and n are number of resources and processes</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/* Step 1 */</span><br><span class="line">init Work[m], Finish[n]</span><br><span class="line">init Work &lt;- Available</span><br><span class="line">for 1..n:</span><br><span class="line">  if Alloc[i] != 0: Finish[i] = false</span><br><span class="line">  else Finish[i] = true</span><br><span class="line"></span><br><span class="line">/* Step 2 */</span><br><span class="line">find i where</span><br><span class="line">  Finish[i] == false and Request[i] &lt;= Work[i]</span><br><span class="line">  jump Step 4</span><br><span class="line">else: jump Step 3</span><br><span class="line"></span><br><span class="line">/* Step 3 */</span><br><span class="line">Work = Work + Allocation[i]</span><br><span class="line">Finish[i] = true</span><br><span class="line">jump Step 2</span><br><span class="line"></span><br><span class="line">/* Step 4 */</span><br><span class="line">if Finish[i] == false:</span><br><span class="line">  P[i] is in deadlock /* process i&#x27;s deadlock detected */</span><br></pre></td></tr></table></figure>
<table>
<tr>
    <td><img src="/2024/09/13/Operating-Systems/os1302.png"></td>
    <td><img src="/2024/09/13/Operating-Systems/os1303.png"></td>
</tr>
</table>

<blockquote>
<p>Explanation: 经过进程 0，0 完成并释放一个资源 B，然而其他进程都无法得到相应资源，进入死锁</p>
</blockquote>
<p><strong>What if Deadlock Detected?</strong></p>
<ul>
<li>Terminate process, force it to give up resources<ul>
<li>Shoot a dining philosopher !?</li>
<li>But, not always possible</li>
</ul>
</li>
<li>Preempt resources without killing off process <ul>
<li>Take away resources from process temporarily</li>
<li>Does not always fit with semantics of computation</li>
</ul>
</li>
<li>Roll back actions of deadlocked process <ul>
<li>Common technique in databases (transactions)</li>
<li>Of course, deadlock may happen once again</li>
</ul>
</li>
</ul>
<h3 id="Deadlock-Prevention"><a href="#Deadlock-Prevention" class="headerlink" title="Deadlock Prevention"></a>Deadlock Prevention</h3><blockquote>
<p>Try to ensure at least one of the requirements of deadlock cannot hold</p>
</blockquote>
<ul>
<li>Remove “Mutual Exclusion” ? impossible for non-sharable resource.</li>
<li>Remove “Hold and Wait” ? low resource utilization or starvation</li>
<li>Remove “Preemption” ?<ul>
<li>If a process that is holding some resources requests another resource that cannot be immediately allocated to it, then all resources currently being held are released 👉 may cause starvation</li>
<li>Process will be restarted only when it can regain its old resources, as well as the new ones that it is requesting</li>
</ul>
</li>
<li>Remove “Circular Wait”<ul>
<li>impose a total ordering of all resource types, and require that each process requests resources in an increasing order of enumeration: $R= \{ R_1, R_2, \cdots , R_m \}$</li>
<li>One to one function $F:R\to N$</li>
<li>If a process request a resource $R_i$, it can request another resource $R_j$ if and only if $F(R_i) \lt F(R_j)$</li>
<li>Or, it must first release all resource $R_i$ such that $F(R_i) \ge F(R_j)$ </li>
</ul>
</li>
</ul>
<p><strong>Some concept go first</strong></p>
<ul>
<li>Deadlock Avoidance<ul>
<li>The deadlock-avoidance algorithm dynamically examines the resource-allocation state to ensure that there can never be a <strong>circular-wait condition</strong></li>
<li>Resource-allocation state is defined by the number of available and allocated resources, and the maximum demands of the processes</li>
</ul>
</li>
<li>Safe State<ul>
<li>System is in safe state if there exists a sequence $<P_1, p_2, \cdots , p_n>$ of <strong>ALL</strong> the processes in the systems such that for each $P_i$, the resources that $P_i$ can still request can be satisfied by currently available resources + resources held by all the $P_j$, with $j &lt; i$</P_1,></li>
</ul>
</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1304.png"></p>
<h4 id="Bankerʼs-Algorithm"><a href="#Bankerʼs-Algorithm" class="headerlink" title="Bankerʼs Algorithm"></a>Bankerʼs Algorithm</h4><p><strong>Idea</strong></p>
<ul>
<li>Multiple instances of each resource type</li>
<li>Each process must a priori claim maximum use</li>
<li>When a process requests a resource it may have to wait </li>
<li>When a process gets all its resources it must return them in a finite amount of time</li>
</ul>
<p><strong>Setting</strong></p>
<ul>
<li><strong>Available</strong>: Vector of length m.</li>
<li><strong>Max</strong>: $n \times m$ matrix. (<code>Max[i, j] = k</code> represent process i can request at most k instances of resource j)</li>
<li><strong>Allocation</strong>: $n \times m$ matrix.</li>
<li><strong>Need</strong>: $n \times m$ matrix.<ul>
<li><code>Need[i,j] = Max[i,j] - Alloc[i,j]</code></li>
</ul>
</li>
</ul>
<p><strong>Pseudo code</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/* Check safe function */</span><br><span class="line">/* 1 */</span><br><span class="line">Init Work = Available, Finish[i] = false for 0..(n-1)</span><br><span class="line">/* 2 */</span><br><span class="line">find i where (Finish[i] is false) and (Need[i][k] &lt;= Work[k] for all k)</span><br><span class="line">if no such i, goto 4</span><br><span class="line">/* 3 */</span><br><span class="line">Work = Work + Alloc[i]</span><br><span class="line">Finish[i] = true</span><br><span class="line">/* 4 */</span><br><span class="line">If Finish[i] == true for all i, then system is in safe state</span><br></pre></td></tr></table></figure>
<p><strong>Resource-Request Algorithm</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/* Request Resource of Process[i] */</span><br><span class="line">/* 1 */</span><br><span class="line">if Request[j] &lt;= Need[j] for all j then goto 2</span><br><span class="line">else raise exception /* process has exceeded its maximum claim */</span><br><span class="line">/* 2 */</span><br><span class="line">if Request[j] &lt;= Avail[j] for all j then goto 3</span><br><span class="line">else wait() /* Process i cannot get enough resource */</span><br><span class="line">/* 3 */</span><br><span class="line">&#123; /* state update */</span><br><span class="line">  Avail = Avail - Request</span><br><span class="line">  Alloc[i] = Alloc[i] + Request</span><br><span class="line">  Need = Need - Request</span><br><span class="line">  if checksafe():  /* define above */</span><br><span class="line">    update()       /* truly alloc  */</span><br><span class="line">  else:</span><br><span class="line">    rollback()     /* undo update  */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Lec14-Security-and-Protection"><a href="#Lec14-Security-and-Protection" class="headerlink" title="Lec14. Security and Protection"></a>Lec14. Security and Protection</h1><h2 id="Outline-12"><a href="#Outline-12" class="headerlink" title="Outline"></a>Outline</h2><ul>
<li>Access Matrix</li>
<li>Security</li>
<li>Cryptography</li>
</ul>
<h2 id="Access-Matrix"><a href="#Access-Matrix" class="headerlink" title="Access Matrix"></a>Access Matrix</h2><h3 id="Principles-of-Protection"><a href="#Principles-of-Protection" class="headerlink" title="Principles of Protection"></a>Principles of Protection</h3><ul>
<li>Programs, users and systems should be given <strong>just enough</strong> privileges to perform their tasks</li>
<li>Limits damage if entity has a bug, gets abused</li>
<li>Can be static (during life of system, during life of process)</li>
<li>Or dynamic (changed by process as needed)</li>
</ul>
<h3 id="Access-Matrix-1"><a href="#Access-Matrix-1" class="headerlink" title="Access Matrix"></a>Access Matrix</h3><ul>
<li>View protection as a matrix (access matrix)</li>
<li>Rows represent domains (e.g. users or processes)</li>
<li>Columns represent objects</li>
<li><code>Access(i, j)</code> is the set of operations that a process executing in Domain i can invoke on Object j (as the following pic shown)</li>
</ul>
<p><img src="/2024/09/13/Operating-Systems/os1305.png"></p>
<ul>
<li><strong>Access matrix</strong> design separates mechanism from policy<ul>
<li>Mechanism <ul>
<li>Operating system provides access-matrix + rules</li>
<li>It ensures that the matrix is only manipulated by authorized agents and that rules are strictly enforced</li>
</ul>
</li>
<li>Policy<ul>
<li>User dictates policy</li>
<li>Who can access what object and in what mode</li>
<li><font color="red">User who creates object can define access column for that object</font>.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Implementation-of-Access-Matrix"><a href="#Implementation-of-Access-Matrix" class="headerlink" title="Implementation of Access Matrix"></a>Implementation of Access Matrix</h3><p>Option 1 —— Global table</p>
<ul>
<li>Store ordered triples <code>&lt;domain, object, rights-set&gt;</code> in table</li>
<li>Problems<ul>
<li>too large to fit in main memory</li>
<li>difficult to group objects (consider an object that all domains can read)</li>
</ul>
</li>
</ul>
<p>Option 2 —— Access-control lists for objects</p>
<ul>
<li>per-object list consists of ordered pairs <code>&lt;domain, rights-set&gt;</code> defining all domains with non-empty set of access rights for the object</li>
</ul>
<p>Option 3 —— Capability list for domains</p>
<ul>
<li>Domain based lists</li>
<li><font color="blue">Capability list</font> for domain is list of objects together with operations allows on them</li>
<li>Object represented by its name or address, called a <font color="blue">capability</font>.</li>
</ul>
<p><strong>Last Solution: Combine Access-control lists and Capability lists.</strong></p>
<h2 id="Security"><a href="#Security" class="headerlink" title="Security"></a>Security</h2><ul>
<li>Concept<ul>
<li>Threat is potential security violation<ul>
<li>Breach of confidentiality: Unauthorized reading of data</li>
<li>Breach of integrity: Unauthorized modification of data</li>
<li>Breach of availability: Unauthorized destruction of data</li>
<li>Theft of service: Unauthorized use of resources</li>
<li>Denial of service (DoS): Prevention of legitimate use</li>
</ul>
</li>
<li>Attack is attempt to breach security</li>
</ul>
</li>
<li>Security must occur at four levels to be effective:<ul>
<li>Physical<ul>
<li>Data centers, servers, connected terminals</li>
</ul>
</li>
<li>Human<ul>
<li>Avoid social engineering, phishing, dumpster diving</li>
</ul>
</li>
<li>Operating System<ul>
<li>Protection mechanisms, debugging</li>
</ul>
</li>
<li>Network<ul>
<li>Intercepted communications, interruption, DoS</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Implementation-of-Security-Defenses"><a href="#Implementation-of-Security-Defenses" class="headerlink" title="Implementation of Security Defenses"></a>Implementation of Security Defenses</h3><ul>
<li>Intrusion detection endeavors to detect attempted or successful intrusions<ul>
<li>Signature-based detection spots known bad patterns</li>
<li>Anomaly detection spots differences from normal behavior</li>
<li>Can detect zero-day attacks</li>
<li>False-positives and false-negatives a problem</li>
</ul>
</li>
<li>Virus protection<ul>
<li>Searching all programs or programs at execution for known virus patterns</li>
<li>Or run in sandbox so can’t damage system</li>
</ul>
</li>
</ul>
<h3 id="Firewalling-to-Protect-Systems-and-Networks"><a href="#Firewalling-to-Protect-Systems-and-Networks" class="headerlink" title="Firewalling to Protect Systems and Networks"></a>Firewalling to Protect Systems and Networks</h3><ul>
<li>A network firewall is placed between trusted and untrusted hosts<ul>
<li>The firewall limits network access between these two security domains</li>
</ul>
</li>
<li>Can be tunneled or spoofed<ul>
<li>Tunneling allows disallowed protocol to travel within allowed protocol (i.e., telnet inside of HTTP)</li>
<li>Firewall rules typically based on host name or IP address which can be spoofed</li>
</ul>
</li>
<li>Personal firewall is software layer on given host<ul>
<li>Can monitor / limit traffic to and from the host</li>
</ul>
</li>
<li>Application proxy firewall understands application protocol and can control them (i.e., SMTP)</li>
<li>System-call firewall monitors all important system calls and apply rules to them (i.e., this program can execute that system call)</li>
</ul>
<p>…</p>
<h2 id="Cryptography"><a href="#Cryptography" class="headerlink" title="Cryptography"></a>Cryptography</h2><h3 id="Encryption"><a href="#Encryption" class="headerlink" title="Encryption"></a>Encryption</h3><ul>
<li>Set $K$ as keys</li>
<li>Set $M$ as messages</li>
<li>Set $C$ as ciphertexts</li>
<li>A function $E:K\to (M\to C)$, where for $k\in K$, $E_k$ is function for generating ciphertexts from messages</li>
<li>A function $D:K\to (C\to M)$, where for $k\in K$, $D_k$ is function for generating ciphertexts from messages</li>
</ul>
<blockquote>
<p>Users who get the <strong>keys</strong> are able to decrypte the ciphertext</p>
</blockquote>
<ul>
<li>Symmetric Encryption vs. Asymmetric Encryption</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">Symmetric</th>
<th style="text-align:center">Asymmetric</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Same key for encrypt and decrypt</td>
<td style="text-align:center">public key for encrypt but private key for decrypt</td>
</tr>
<tr>
<td style="text-align:center">Block cipher / Stream cipher</td>
<td style="text-align:center">Using an reliable encryption scheme</td>
</tr>
<tr>
<td style="text-align:center">DES, Advanced Encryption Standard (AES), RC4(Stream)</td>
<td style="text-align:center">RSA</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Authentication"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication</h3><blockquote>
<p>Algorithm alike encrypt, but no decrypt 👉 function $K \to (M\times A\to \{ true,false \})$ to verify auth</p>
</blockquote>
<ul>
<li>Usage<ul>
<li>Message-authentication code (MAC) authentication algorithm<ul>
<li>symm based</li>
</ul>
</li>
<li>Digital signatures authentication algorithm<ul>
<li>asym based</li>
<li><strong>anyone</strong> can verify authenticity of a message using the public key</li>
</ul>
</li>
</ul>
</li>
<li>Key Distribution<ul>
<li>Delivery of symmetric key is huge challenge<ul>
<li>Sometimes done out-of-band (?)</li>
</ul>
</li>
<li>Asymmetric keys distribution – public key<ul>
<li>Even asymmetric key distribution needs care – man-in-the-middle attack</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Certification-in-Network"><a href="#Certification-in-Network" class="headerlink" title="Certification in Network"></a>Certification in Network</h3><ul>
<li>Used between web servers and browsers for secure communication (credit card numbers)</li>
<li>The server is verified with a <strong>certificate</strong> assuring client is talking to correct server</li>
<li>Asymmetric cryptography used to establish a secure <strong>session key</strong> (symmetric encryption) for bulk of communication during session</li>
<li>Communication between each computer then uses symmetric key cryptography</li>
</ul>
<h1 id="Lec15-Virtualization"><a href="#Lec15-Virtualization" class="headerlink" title="Lec15. Virtualization"></a>Lec15. Virtualization</h1><h2 id="Outline-13"><a href="#Outline-13" class="headerlink" title="Outline"></a>Outline</h2><h2 id="About-Virtualization"><a href="#About-Virtualization" class="headerlink" title="About Virtualization"></a>About Virtualization</h2><ul>
<li>Virtualization leverages a software component (i.e., the hypervisor) and some hardware support to create an abstraction layer over computer hardware </li>
<li>It enables the hardware resources of a single computer (processors, memory, storage) to be multiplexed by multiple virtual machines (VMs). </li>
<li>VMs run their own operating systems (OS) and operate as if they are independent computers, though they are using only a portion of the underlying computer hardware. </li>
</ul>
<p><strong>Types of Virtualization</strong></p>
<ul>
<li>Type-I hypervisor: run directly on the host’s physical hardware</li>
<li>Type-II hypervisor: installed on existing OSs, and rely on them for virtualization and resource managemen</li>
</ul>
<p>…</p>

    </div>
    
    <div>
      
      <div>
    
        <div style="text-align:center;color: #9d9d9d;font-size:18px;">------------- 本文结束 <i class="fas fa-book-reader"></i> 感谢阅读 -------------</div>
    
</div>
      
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CSE-Learning/" rel="tag"># CSE Learning</a>
              <a href="/tags/Rust/" rel="tag"># Rust</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/09/09/Computer-Networks/" rel="prev" title="计算机网络">
                  <i class="fa fa-angle-left"></i> 计算机网络
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","cdn":"//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
